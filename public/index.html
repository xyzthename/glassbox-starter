<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlassBox ‚Äì Solana Token Risk Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #05060a;
      --card: #0b0f16;
      --accent: #16f29a;
      --accent-soft: rgba(22, 242, 154, 0.12);
      --border-subtle: rgba(255, 255, 255, 0.06);
      --text-main: #f7f9ff;
      --text-muted: #9ca3b5;
      --danger: #ff4b6b;
      --warn: #ffb347;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020308 55%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 24px 12px;
    }

    .app {
      width: 100%;
      max-width: 960px;
      margin: auto;
    }

    .shell {
      background: linear-gradient(135deg, rgba(22, 242, 154, 0.08), rgba(59, 130, 246, 0.04));
      border-radius: 32px;
      padding: 1px;
      box-shadow: 0 18px 60px rgba(0, 0, 0, 0.7);
    }

    .inner {
      background: rgba(5, 7, 14, 0.96);
      border-radius: 32px;
      padding: 24px 20px 20px;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.2fr);
      gap: 20px;
    }

    @media (max-width: 780px) {
      .inner {
        grid-template-columns: minmax(0, 1fr);
        padding: 20px 16px 16px;
      }
    }

    .hero-title {
      font-size: 28px;
      line-height: 1.1;
      font-weight: 700;
      letter-spacing: -0.03em;
      margin-bottom: 8px;
    }

    .hero-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(22, 242, 154, 0.07);
      border: 1px solid rgba(22, 242, 154, 0.35);
      color: var(--accent);
      margin-bottom: 10px;
    }

    .hero-sub {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 18px;
      max-width: 360px;
    }

    .input-block {
      background: rgba(7, 10, 18, 0.85);
      border-radius: 18px;
      padding: 12px 12px 14px;
      border: 1px solid var(--border-subtle);
    }

    .input-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .input-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
    }

    .input-hint {
      font-size: 11px;
      color: var(--text-muted);
      opacity: 0.85;
    }

    .input-row {
      display: flex;
      gap: 10px;
      align-items: stretch;
    }

    input[type="text"] {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: radial-gradient(circle at top left, #020617, #020617 55%, #020617);
      color: var(--text-main);
      padding: 9px 14px;
      font-size: 13px;
      outline: none;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9) inset;
    }

    input[type="text"]::placeholder {
      color: rgba(148, 163, 184, 0.8);
      font-size: 12px;
    }

    button {
      border: none;
      cursor: pointer;
      font-family: inherit;
    }

    .btn-primary {
      padding: 9px 18px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      background: radial-gradient(circle at top, #22c55e, #16a34a);
      color: #020617;
      box-shadow: 0 10px 25px rgba(22, 163, 74, 0.45);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary:disabled {
      opacity: 0.55;
      cursor: default;
      box-shadow: none;
    }

    .btn-secondary {
      padding: 7px 14px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .hint-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      gap: 8px;
    }

    .hint-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 9px;
      border-radius: 999px;
      font-size: 11px;
      color: var(--text-muted);
      background: rgba(15, 23, 42, 0.9);
      border: 1px dashed rgba(148, 163, 184, 0.45);
    }

    .preset-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
    }

    .preset-btn {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-muted);
      cursor: pointer;
    }

    .preset-risk-safe { color: #22c55e; font-weight: 600; }
    .preset-risk-caution { color: #eab308; font-weight: 600; }
    .preset-risk-risky { color: #f97316; font-weight: 600; }
    .preset-risk-veryrisk { color: #ef4444; font-weight: 600; }
    .preset-risk-unknown { color: var(--text-muted); }

    /* Right pane */
    .result-card {
      background: radial-gradient(circle at top left, #020617, #020617 60%, #020617);
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 14px 14px 12px;
      min-height: 260px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }

    .result-header-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
    }

    .risk-tag {
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .risk-low {
      background: rgba(22, 242, 154, 0.18);
      color: var(--accent);
      border: 1px solid rgba(22, 242, 154, 0.5);
    }

    .risk-med {
      background: rgba(255, 179, 71, 0.15);
      color: var(--warn);
      border: 1px solid rgba(255, 179, 71, 0.55);
    }

    .risk-high {
      background: rgba(255, 75, 107, 0.18);
      color: var(--danger);
      border: 1px solid rgba(255, 75, 107, 0.6);
    }

    .token-title-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 4px;
    }

    .token-logo {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      flex-shrink: 0;
    }

    .token-title-main {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .token-symbol {
      font-size: 12px;
      color: var(--text-muted);
    }

    .token-mint {
      font-size: 11px;
      color: var(--text-muted);
      word-break: break-all;
    }

    .result-summary {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .summary-strong {
      color: #e5e7ff;
    }

    /* Scam score bar */
    .scam-score-wrap {
      margin-bottom: 6px;
    }

    .scam-score-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    .scam-score-value {
      font-weight: 600;
      color: #e5e7ff;
    }

    .scam-score-bar {
      height: 6px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.9);
      overflow: hidden;
      position: relative;
    }

    .scam-score-fill {
      height: 100%;
      border-radius: inherit;
      /* low -> high = red ‚Üí green */
      background: linear-gradient(90deg, #ef4444, #f97316, #eab308, #22c55e);
      transform-origin: left;
      transform: scaleX(0.5);
    }

    .metric-strip {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 6px;
      font-size: 11px;
      margin-bottom: 4px;
    }

    @media (max-width: 620px) {
      .metric-strip {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .metric-pill {
      padding: 6px 7px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .metric-label {
      color: var(--text-muted);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 3px;
    }

    .metric-value {
      font-size: 12px;
      font-weight: 500;
      color: #e5e7ff;
    }

    .metric-sub {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 1px;
    }

    .result-sections {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1.1fr);
      gap: 8px;
      margin-bottom: 4px;
    }

    @media (max-width: 520px) {
      .result-sections {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .result-section {
      border-radius: 14px;
      padding: 8px 9px;
      border: 1px dashed rgba(51, 65, 85, 0.9);
      background: rgba(15, 23, 42, 0.9);
      margin-top: 4px;
    }

    .result-section h3 {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      margin: 0 0 4px;
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      font-size: 11px;
      margin-bottom: 2px;
    }

    .result-label {
      color: var(--text-muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 600;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
    }

    .badge-good {
      border-color: rgba(22, 242, 154, 0.7);
      color: var(--accent);
      background: rgba(22, 242, 154, 0.12);
    }

    .badge-bad {
      border-color: rgba(248, 113, 113, 0.8);
      color: var(--danger);
      background: rgba(248, 113, 113, 0.16);
    }

    .badge-warn {
      border-color: rgba(234, 179, 8, 0.8);
      color: var(--warn);
      background: rgba(234, 179, 8, 0.16);
    }

    .holders-bar {
      margin-top: 4px;
      height: 5px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.9);
      overflow: hidden;
    }

    .holders-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #22c55e, #eab308, #f97316, #ef4444);
    }

    .result-small {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 3px;
    }

    .origin-row {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    /* Holders list */
    .holders-list {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center; /* center pills */
    }

    .holder-chip {
      font-size: 11px;
      padding: 5px 11px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7ff;
      text-decoration: none;
    }

    .holder-chip.lp-holder {
      border-color: rgba(56, 189, 248, 0.85);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.45);
    }

    .holder-chip:hover {
      border-color: var(--accent);
    }

    /* Tools row */
    .tools-row {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tool-btn {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7ff;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      text-decoration: none;
      cursor: pointer;
    }

    .tool-btn span { font-size: 11px; }

    .tool-btn:hover {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(22, 242, 154, 0.32);
    }

    .actions-row {
      margin-top: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .actions-left {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .actions-right { margin-left: auto; }

    .btn-ghost {
      border-radius: 999px;
      padding: 5px 10px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .error-box {
      font-size: 12px;
      color: var(--danger);
      background: rgba(248, 113, 113, 0.08);
      border-radius: 12px;
      border: 1px solid rgba(248, 113, 113, 0.4);
      padding: 7px 9px;
      margin-top: 6px;
    }

    footer {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: right;
      opacity: 0.8;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
    }

    footer a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="app">
    <div class="shell">
      <div class="inner">
        <!-- LEFT / INPUT -->
        <div>
          <div class="hero-pill">
            <span>üü¢ GlassBox v0.1</span>
            <span>Mint ¬∑ Freeze ¬∑ Holders ¬∑ Origin</span>
          </div>
          <div class="hero-title">
            Paste a Solana token mint.<br />
            See if it‚Äôs <span style="color: var(--accent)">clean or toxic</span> in seconds.
          </div>
          <div class="hero-sub">
            No wallet connect. No signup. Just an instant on-chain safety read on any SPL token mint.
          </div>

          <div class="input-block">
            <div class="input-label-row">
              <div class="input-label">Token mint address</div>
              <div class="input-hint">Solana SPL or Token-2022 mint</div>
            </div>
            <div class="input-row">
              <input
                id="mintInput"
                type="text"
                placeholder="Ex: EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1 (USDC)"
              />
              <button id="checkBtn" class="btn-primary">
                <span id="checkBtnLabel">Scan</span>
                <span id="checkBtnSpinner" style="display:none;">‚è≥</span>
              </button>
            </div>
            <div class="hint-row">
              <div class="hint-pill">
                <span>üí°</span>
                <span>We never see or store your wallet or keys.</span>
              </div>
              <div class="preset-row" id="recentRow">
                <!-- recent tokens rendered by JS -->
              </div>
            </div>
          </div>

          <footer>
            Built for degen safety by
            <a href="https://x.com/Glassboxscans" target="_blank" rel="noopener noreferrer">@GlassBox</a>
          </footer>
        </div>

        <!-- RIGHT / RESULT -->
        <div>
          <div class="result-card" id="resultCard">
            <div id="resultBox" style="font-size:12px;color:var(--text-muted);">
              Paste a Solana token mint on the left and hit <strong>Scan</strong> to see:
              <ul style="padding-left:18px;margin:6px 0 2px;">
                <li>Mint &amp; freeze authority status</li>
                <li>Holder concentration risk + top wallets</li>
                <li>Protocol origin hints</li>
                <li>Readable supply, price, liquidity &amp; token age</li>
              </ul>
              Then route to Jupiter, DexScreener, Axiom, Photon, BullX, Padre, or StalkFun in one tap.
            </div>
            <div id="errorBox" class="error-box" style="display:none;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
  const API_BASE = "/api/check";
  const RECENT_KEY = "glassbox_recent_mints_v1";

  const mintInput = document.getElementById("mintInput");
  const checkBtn = document.getElementById("checkBtn");
  const checkBtnLabel = document.getElementById("checkBtnLabel");
  const checkBtnSpinner = document.getElementById("checkBtnSpinner");
  const resultBox = document.getElementById("resultBox");
  const errorBox = document.getElementById("errorBox");
  const recentRow = document.getElementById("recentRow");

  function setLoading(isLoading) {
    if (isLoading) {
      checkBtn.disabled = true;
      checkBtnLabel.textContent = "Scanning‚Ä¶";
      checkBtnSpinner.style.display = "inline";
    } else {
      checkBtn.disabled = false;
      checkBtnLabel.textContent = "Scan";
      checkBtnSpinner.style.display = "none";
    }
  }

  // ---------- PRICE FORMATTING (with 0.0‚ÇÜ57 style) ----------

  const SUBSCRIPT_MAP = {
    "0": "‚ÇÄ",
    "1": "‚ÇÅ",
    "2": "‚ÇÇ",
    "3": "‚ÇÉ",
    "4": "‚ÇÑ",
    "5": "‚ÇÖ",
    "6": "‚ÇÜ",
    "7": "‚Çá",
    "8": "‚Çà",
    "9": "‚Çâ",
  };

  function toSubscript(num) {
    return String(num)
      .split("")
      .map((d) => SUBSCRIPT_MAP[d] || d)
      .join("");
  }

  // For super tiny prices like 0.00000057 ‚Üí "$0.0‚ÇÜ57"
  function formatTinyUsd(n) {
    if (!isFinite(n) || n <= 0) return "$0";

    const s = n.toFixed(12);
    const parts = s.split(".");
    const dec = (parts[1] || "").replace(/0+$/, "");

    if (!dec) return "$0";

    let zeroCount = 0;
    let digits = "";
    for (const ch of dec) {
      if (ch === "0" && digits === "") {
        zeroCount++;
      } else {
        digits += ch;
      }
    }
    if (!digits) return "$0";

    const sub = toSubscript(zeroCount);
    return `$0.0${sub}${digits}`;
  }

  function formatUsd(value) {
    if (value === null || value === undefined || isNaN(value)) return "N/A";
    const n = Number(value);
    if (!isFinite(n) || n <= 0) return "$0";

    if (n < 0.0001) {
      return formatTinyUsd(n);
    }

    if (n < 1) {
      return (
        "$" +
        n
          .toFixed(6)
          .replace(/0+$/, "")
          .replace(/\.$/, "")
      );
    }
    if (n < 1000) {
      return (
        "$" +
        n
          .toFixed(4)
          .replace(/0+$/, "")
          .replace(/\.$/, "")
      );
    }
    if (n < 1_000_000) {
      return "$" + n.toLocaleString(undefined, { maximumFractionDigits: 0 });
    }
    if (n < 1_000_000_000) {
      return (
        "$" +
        (n / 1_000_000)
          .toFixed(2)
          .replace(/0+$/, "")
          .replace(/\.$/, "") +
        "M"
      );
    }
    if (n < 1_000_000_000_000) {
      return (
        "$" +
        (n / 1_000_000_000)
          .toFixed(2)
          .replace(/0+$/, "")
          .replace(/\.$/, "") +
        "B"
      );
    }
    return (
      "$" +
      (n / 1_000_000_000_000)
        .toFixed(2)
        .replace(/0+$/, "")
        .replace(/\.$/, "") +
      "T"
    );
  }

  // ---------- OTHER HELPERS ----------

  function formatNumber(value) {
    if (value == null || isNaN(value)) return "‚Äî";
    const n = Number(value);
    if (n < 1_000_000) {
      return n.toLocaleString(undefined, { maximumFractionDigits: 0 });
    }
    if (n < 1_000_000_000) {
      return (n / 1_000_000).toFixed(2) + "M";
    }
    if (n < 1_000_000_000_000) {
      return (n / 1_000_000_000).toFixed(2) + "B";
    }
    return (n / 1_000_000_000_000).toFixed(2) + "T";
  }

  function shortAddr(addr) {
    if (!addr || addr.length <= 8) return addr;
    return addr.slice(0, 4) + "‚Ä¶" + addr.slice(-4);
  }

  function renderError(message) {
    errorBox.style.display = "block";
    errorBox.textContent =
      message || "Something went wrong while checking this mint.";
    resultBox.innerHTML = "";
  }

  function loadRecent() {
    try {
      const raw = localStorage.getItem(RECENT_KEY);
      if (!raw) return [];
      const arr = JSON.parse(raw);
      if (!Array.isArray(arr)) return [];
      return arr;
    } catch {
      return [];
    }
  }

  function saveRecent(list) {
    try {
      localStorage.setItem(RECENT_KEY, JSON.stringify(list));
    } catch {
      // ignore
    }
  }

  function labelForRisk(level) {
    if (level === "low") return "Safe";
    if (level === "medium") return "Caution";
    if (level === "risky") return "Risky";
    if (level === "high") return "Very risky";
    return "Unknown";
  }

  function presetRiskClass(level) {
    if (level === "low") return "preset-risk-safe";
    if (level === "medium") return "preset-risk-caution";
    if (level === "risky") return "preset-risk-risky";
    if (level === "high") return "preset-risk-veryrisk";
    return "preset-risk-unknown";
  }

  function renderRecentRow() {
    const recent = loadRecent();
    if (!recent.length) {
      const defaults = [
        {
          mint: "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1",
          display: "USDC",
          level: "low",
        },
        {
          mint: "DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263",
          display: "BONK",
          level: "medium",
        },
      ];
      recentRow.innerHTML = defaults
        .map(
          (r) => `
            <button class="preset-btn" data-mint="${r.mint}">
              ${r.display}
              <span class="${presetRiskClass(r.level)}">¬∑ ${labelForRisk(
                r.level
              )}</span>
            </button>`
        )
        .join("");
    } else {
      recentRow.innerHTML = recent
        .map(
          (r) => `
            <button class="preset-btn" data-mint="${r.mint}">
              ${r.display}
              <span class="${presetRiskClass(r.level)}">¬∑ ${labelForRisk(
                r.level
              )}</span>
            </button>`
        )
        .join("");
    }

    document.querySelectorAll(".preset-btn").forEach((btn) => {
      btn.onclick = () => {
        const mint = btn.getAttribute("data-mint");
        if (mint) {
          mintInput.value = mint;
          handleCheck();
        }
      };
    });
  }

  function addRecent(entry) {
    const current = loadRecent();
    const filtered = current.filter((r) => r.mint !== entry.mint);
    filtered.unshift(entry);
    const trimmed = filtered.slice(0, 5);
    saveRecent(trimmed);
    renderRecentRow();
  }

  function formatAge(tokenAge) {
    const days = tokenAge?.ageDays;
    if (days == null || isNaN(days)) {
      return { main: "‚Äî", sub: "" };
    }
    if (days < 1) {
      const hours = Math.floor(days * 24);
      return { main: `${hours}h`, sub: "since mint" };
    }
    if (days < 30) {
      const d = Math.floor(days);
      return { main: `${d}d`, sub: "since mint" };
    }
    if (days < 365) {
      const months = (days / 30).toFixed(1);
      return { main: `${months}m`, sub: `‚âà ${Math.floor(days)} days` };
    }
    const years = (days / 365).toFixed(1);
    return { main: `${years}y`, sub: `‚âà ${Math.floor(days)} days` };
  }

  // ---------- MAIN SCAN HANDLER ----------

  async function handleCheck() {
    const mint = (mintInput.value || "").trim();
    if (!mint) {
      renderError("Please paste a valid Solana token mint address.");
      return;
    }

    errorBox.style.display = "none";
    errorBox.textContent = "";
    setLoading(true);

    try {
      const res = await fetch(API_BASE + "?mint=" + encodeURIComponent(mint));
      const data = await res.json();

      if (!res.ok) {
        throw new Error(data?.error || "Backend error");
      }

      const {
        tokenMeta,
        mintInfo,
        freezeAuthority,
        mintAuthority,
        holderSummary,
        insiderSummary,
        originHint,
        riskSummary,
        tokenMetrics,
        tokenAge,
        liquidityTruth,
      } = data;

      const canonicalMint = mint.trim();

      const jupUrl = `https://jup.ag/swap/SOL-${canonicalMint}?ref=3Gkf49tYL3JNjawedx9HX94LbnSMQ6eTQLTR8i8rkxWG`;
      const dexscreenerUrl = `https://dexscreener.com/solana/${canonicalMint}`;

      const riskLevel = riskSummary?.level || "unknown";
      let riskClass = "risk-med";
      let riskLabel = "Unknown risk";
      if (riskLevel === "low") {
        riskClass = "risk-low";
        riskLabel = "Low rug risk (mint side)";
      } else if (riskLevel === "medium") {
        riskClass = "risk-med";
        riskLabel = "Medium risk";
      } else if (riskLevel === "high") {
        riskClass = "risk-high";
        riskLabel = "High rug risk";
      }

      let scamScore = Number(riskSummary?.score);
      if (isNaN(scamScore) || scamScore < 0 || scamScore > 100) {
        if (riskLevel === "low") scamScore = 85;
        else if (riskLevel === "medium") scamScore = 55;
        else if (riskLevel === "high") scamScore = 20;
        else scamScore = 50;
      }

      const name = tokenMeta?.name || "Unknown Token";
      const symbol = tokenMeta?.symbol || "";
      const logo = tokenMeta?.logoURI || null;

      const priceUsd = tokenMetrics?.priceUsd ?? null;
      const liquidityUsd = tokenMetrics?.liquidityUsd ?? null;

      const rawSupply = mintInfo?.supply;
      const decimals = mintInfo?.decimals ?? 0;
      const supplyHuman =
        rawSupply != null
          ? Number(rawSupply) / Math.pow(10, decimals || 0)
          : null;

      const lpHolder = holderSummary?.lpHolder || null;
      const topHolders = holderSummary?.topHolders || [];
      const holdersCount = holderSummary?.holdersCount ?? null;

      // Top 10 excluding LP % for the badge
      const holdersTop10 =
        holderSummary?.top10PctExcludingLP != null
          ? holderSummary.top10PctExcludingLP
          : holderSummary?.top10Pct ?? null;

      const holdersBarWidth =
        holdersTop10 != null
          ? Math.min(100, Math.max(0, holdersTop10))
          : 0;

      const holdersLabel =
        holdersTop10 != null
          ? `${holdersTop10.toFixed(
              1
            )}% held by top 10 wallets (excl. LP)`
          : "No holder data";

      const renouncedMint = !mintAuthority;
      const canMintMore = !!mintAuthority;
      const canFreeze = !!freezeAuthority;

      const originText = originHint?.label || "Unknown protocol / origin";
      const originDetail = originHint?.detail || "";

      const riskBlurb = riskSummary?.blurb || "";
      const scamScoreClamped = Math.min(100, Math.max(0, scamScore));
      const scamScoreScale = scamScoreClamped / 100;

      const holdersListHtml = topHolders.length
        ? `<div class="holders-list">
            ${topHolders
              .map((h, idx) => {
                const rank = String(idx + 1).padStart(2, "0");
                const isLp =
                  lpHolder &&
                  lpHolder.address &&
                  lpHolder.address === h.address;
                return `<a class="holder-chip${
                  isLp ? " lp-holder" : ""
                }" href="https://solscan.io/account/${
                  h.address
                }" target="_blank" rel="noopener noreferrer">
                    ${rank}. ${shortAddr(h.address)} ¬∑ ${h.pct.toFixed(2)}%${
                  isLp ? " üíß" : ""
                }
                  </a>`;
              })
              .join("")}
          </div>`
        : `<div class="result-small" style="margin-top:4px;">
            Holder list not available for this mint yet.
          </div>`;

      const ageFmt = formatAge(tokenAge);

      const insiders = insiderSummary || {};
      const insidersTotalPct = insiders.insidersTotalPct ?? null;
      const insiderCount = insiders.insiderCount ?? 0;
      const whaleCount = insiders.whaleCount ?? 0;
      const largestInsiderPct =
        insiders.largestInsider?.pct ?? null;
      const insiderRiskLevel = insiders.riskLevel || "low";
      const insiderNote = insiders.note || "";

      let insiderBadgeClass = "badge-good";
      if (insiderRiskLevel === "high") {
        insiderBadgeClass = "badge-bad";
      } else if (insiderRiskLevel === "medium") {
        insiderBadgeClass = "badge-warn";
      }

      // Liquidity truth from backend
      const liqTruth = liquidityTruth || {};
      const liqTruthLevel = liqTruth.level || "unknown";
      const liqTruthLabel = liqTruth.label || "Unknown";
      const liqTruthNote =
        liqTruth.note ||
        "Not enough on-chain / DEX data yet to evaluate liquidity quality.";

      let liqTruthBadgeClass = "";
      if (liqTruthLevel === "low") liqTruthBadgeClass = "badge-good";
      else if (liqTruthLevel === "medium") liqTruthBadgeClass = "badge-warn";
      else if (liqTruthLevel === "high") liqTruthBadgeClass = "badge-bad";


      const displayForRecent =
        symbol || name || shortAddr(canonicalMint) || "Token";
      addRecent({
        mint: canonicalMint,
        display: displayForRecent,
        level: riskLevel,
      });

      resultBox.innerHTML = `
        <div class="result-header-line">
          <div class="risk-tag ${riskClass}">
            <span>‚óè</span>
            <span>${riskLabel}</span>
          </div>
          <div style="font-size:11px;color:var(--text-muted);">
            Live on-chain scan
          </div>
        </div>

        <div class="token-title-row">
          <div class="token-logo" style="${
            logo
              ? "background-image:url('" +
                logo.replace(/'/g, "\\'") +
                "');"
              : "background: radial-gradient(circle at 30% 10%, #4ade80, #16a34a);"
          }"></div>
          <div style="min-width:0;">
            <div class="token-title-main">
              <span>${name}</span>
              ${symbol ? `<span class="token-symbol">(${symbol})</span>` : ""}
            </div>
            <div class="token-mint">${canonicalMint}</div>
          </div>
        </div>

        ${
          riskBlurb
            ? `<div class="result-summary">
                <span class="summary-strong">${riskBlurb}</span>
              </div>`
            : ""
        }

        <div class="scam-score-wrap">
          <div class="scam-score-header">
            <span>GlassBox scam score (0‚Äì100)</span>
            <span class="scam-score-value">${scamScoreClamped.toFixed(
              0
            )}/100</span>
          </div>
          <div class="scam-score-bar">
            <div class="scam-score-fill" style="transform:scaleX(${scamScoreScale});"></div>
          </div>
        </div>

        <div class="metric-strip">
          <div class="metric-pill">
            <div class="metric-label">Price</div>
            <div class="metric-value">${formatUsd(priceUsd)}</div>
          </div>
          <div class="metric-pill">
            <div class="metric-label">Liquidity</div>
            <div class="metric-value">${formatUsd(liquidityUsd)}</div>
          </div>
          <div class="metric-pill">
            <div class="metric-label">Total Supply</div>
            <div class="metric-value">${
              supplyHuman != null ? formatNumber(supplyHuman) : "‚Äî"
            }</div>
          </div>
          <div class="metric-pill">
            <div class="metric-label">Holders</div>
            <div class="metric-value">
              ${
                holdersCount != null
                  ? formatNumber(holdersCount)
                  : "‚Äî"
              }
            </div>
          </div>
          <div class="metric-pill">
            <div class="metric-label">Token Age</div>
            <div class="metric-value">${ageFmt.main}</div>
            ${
              ageFmt.sub
                ? `<div class="metric-sub">${ageFmt.sub}</div>`
                : ""
            }
          </div>
        </div>

        <div class="result-sections">
          <div class="result-section">
            <h3>Mint &amp; freeze controls</h3>
            <div class="result-row">
              <span class="result-label">Mint authority</span>
              <span class="badge ${
                renouncedMint ? "badge-good" : "badge-bad"
              }">
                ${renouncedMint ? "Renounced / Disabled" : "Can still mint"}
              </span>
            </div>
            <div class="result-row">
              <span class="result-label">Freeze authority</span>
              <span class="badge ${canFreeze ? "badge-bad" : "badge-good"}">
                ${canFreeze ? "Can freeze tokens" : "None"}
              </span>
            </div>
            <div class="result-row">
              <span class="result-label">Liquidity truth</span>
              <span
                class="badge ${liqTruthBadgeClass}"
                title="${liqTruthNote}"
              >
                ${liqTruthLabel}
              </span>
            </div>
            <div class="result-small">
              ${
                canMintMore
                  ? "Dev can still print new tokens into their own wallets or LP."
                  : "No more supply can be minted from this mint authority."
              }
            </div>
          </div>

          <div class="result-section">
            <h3>Holder risk</h3>

            <div class="result-row">
              <span class="result-label">Top 10 wallets</span>
              <span class="badge ${
                holdersTop10 != null && holdersTop10 <= 25
                  ? "badge-good"
                  : holdersTop10 != null && holdersTop10 <= 60
                  ? "badge-warn"
                  : "badge-bad"
              }">
                ${
                  holdersTop10 != null
                    ? `${holdersTop10.toFixed(1)}%`
                    : "Unknown"
                }
              </span>
            </div>

            <div class="result-row">
              <span class="result-label">Insider wallets</span>
              <span
                class="badge ${insiderBadgeClass}"
                title="${
                  insiderCount
                    ? `${insiderCount} wallets each hold at least 1% of the total supply (LP excluded).`
                    : `No non-LP wallet holds ‚â•1% of the total supply.`
                }"
              >
                ${
                  insiderCount
                    ? `${insiderCount} ‚â•1% holder${
                        insiderCount > 1 ? "s" : ""
                      }`
                    : "Low"
                }
              </span>
            </div>

            <div class="holders-bar">
              <div class="holders-bar-fill" style="width:${holdersBarWidth}%;"></div>
            </div>
            <div class="result-small">${holdersLabel}</div>
            ${holdersListHtml}
            <div class="result-small" style="margin-top:4px;">
              ${
                insiderNote
                  ? insiderNote
                  : "Based on non-LP distribution only ‚Äì wallets holding ‚â•1% are treated as insiders/whales."
              }
            </div>
          </div>
        </div>

        <div class="result-section">
          <h3>Origin signal</h3>
          <div class="origin-row">
            <strong>${originText}</strong>${
        originDetail ? ` ¬∑ ${originDetail}` : ""
      }
          </div>
          <div class="result-small">
            Origin hints help you see whether this came from a known protocol (Pump, Bags,
            Raydium, Moonshot, etc.) or a custom deployment.
          </div>
        </div>

        <div class="result-section">
          <h3>Tools</h3>
          <div class="tools-row">
            <a class="tool-btn" href="${dexscreenerUrl}" target="_blank" rel="noopener noreferrer">
              <span>üìä DexScreener</span>
            </a>
            <a class="tool-btn" href="https://axiom.trade/@dudexyz" target="_blank" rel="noopener noreferrer">
              <span>üìà Axiom</span>
            </a>
            <a class="tool-btn" href="https://t.me/BullxBetaBot?start=access_N3OJF4TE16J" target="_blank" rel="noopener noreferrer">
              <span>üêÇ BullX Bot</span>
            </a>
            <a class="tool-btn" href="https://trade.padre.gg/rk/dudexyz" target="_blank" rel="noopener noreferrer">
              <span>üß† Padre</span>
            </a>
            <a class="tool-btn" href="https://photon-sol.tinyastro.io/@xyzthegod" target="_blank" rel="noopener noreferrer">
              <span>‚ö° Photon</span>
            </a>
            <a class="tool-btn" href="https://stalk.fun/?r=ZATEZOJI" target="_blank" rel="noopener noreferrer">
              <span>üëÅÔ∏è StalkFun</span>
            </a>
          </div>
          <div class="result-small">
            These are your referral links. Using them supports GlassBox at no extra cost to the user.
          </div>
          <div class="result-small" style="margin-top:4px;text-align:right;font-size:10px;">
            <span style="opacity:0.85;">GlassBox Pro (degen alerts &amp; MEV shield) coming soon.</span>
          </div>
        </div>

        <div class="actions-row">
          <div class="actions-left">
            <a
              class="btn-secondary"
              href="${jupUrl}"
              target="_blank"
              rel="noopener noreferrer"
            >
              üîÑ Swap on Jupiter
            </a>
          </div>
          <div class="actions-right">
            <button class="btn-ghost" id="copyMintBtn">
              üìã Copy Contract Address
            </button>
          </div>
        </div>
      `;

      const copyBtn = document.getElementById("copyMintBtn");
      if (copyBtn) {
        copyBtn.onclick = async () => {
          try {
            await navigator.clipboard.writeText(canonicalMint);
            copyBtn.textContent = "‚úÖ Copied";
            setTimeout(() => {
              copyBtn.textContent = "üìã Copy mint";
            }, 1200);
          } catch (e) {
            console.error(e);
          }
        };
      }
    } catch (err) {
      console.error(err);
      renderError(err.message || "Failed to scan this mint.");
    } finally {
      setLoading(false);
    }
  }

  checkBtn.addEventListener("click", handleCheck);
  mintInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      handleCheck();
    }
  });

  renderRecentRow();
</script>
</body>
</html>

