<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlassBox ‚Äì Solana Token Risk Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #05060a;
      --card: #0b0f16;
      --accent: #16f29a;
      --accent-soft: rgba(22, 242, 154, 0.12);
      --border-subtle: rgba(255, 255, 255, 0.06);
      --text-main: #f7f9ff;
      --text-muted: #9ca3b5;
      --danger: #ff4b6b;
      --warn: #facc15;
      --good: #22c55e;
      --chip-bg: rgba(15, 23, 42, 0.95);
      --chip-border: rgba(148, 163, 184, 0.7);
      --toxic: #ef4444;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #020617 0, #000 45%, #020617 100%);
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "SF Pro Display", "Segoe UI", sans-serif;
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      position: relative;
    }

    .glass-cracks-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.2;
      background-image:
        radial-gradient(circle at 20% 10%, rgba(148, 163, 184, 0.15) 0, transparent 55%),
        radial-gradient(circle at 80% 0%, rgba(148, 163, 184, 0.1) 0, transparent 55%),
        radial-gradient(circle at 50% 100%, rgba(55, 65, 81, 0.18) 0, transparent 60%);
      mix-blend-mode: screen;
      z-index: 0;
    }

    .app {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 1120px;
    }

    .frame {
      width: 100%;
      border-radius: 28px;
      padding: 1px;
      background: radial-gradient(circle at top left, #22c55e, transparent 45%),
        radial-gradient(circle at bottom right, #0ea5e9, transparent 45%),
        linear-gradient(135deg, #020617, #020617);
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 18px 60px rgba(0, 0, 0, 0.75);
    }

    .inner {
      border-radius: 26px;
      background:
        radial-gradient(circle at top left, rgba(34, 197, 94, 0.08), transparent 60%),
        radial-gradient(circle at bottom right, rgba(56, 189, 248, 0.08), transparent 55%),
        #020617;
      padding: 18px 18px 18px 18px;
      border: 1px solid rgba(15, 23, 42, 0.95);
      display: flex;
      gap: 16px;
      position: relative;
      overflow: hidden;
    }

    .inner::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(115deg, rgba(148, 163, 184, 0.06) 0, transparent 40%, transparent 60%, rgba(148, 163, 184, 0.04) 100%),
        radial-gradient(circle at 0 0, rgba(30, 64, 175, 0.45) 0, transparent 60%);
      mix-blend-mode: soft-light;
      opacity: 0.6;
      pointer-events: none;
    }

    .inner::after {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(
          130deg,
          transparent 0,
          rgba(148, 163, 184, 0.12) 24%,
          rgba(15, 23, 42, 0.75) 26%,
          rgba(15, 23, 42, 0.98) 60%,
          transparent 100%
        );
      mix-blend-mode: hard-light;
      pointer-events: none;
      opacity: 0.65;
    }

    .left-col,
    .right-col {
      position: relative;
      z-index: 1;
    }

    .left-col {
      flex: 1.05;
      padding: 16px 14px 12px 14px;
      border-radius: 20px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(2, 6, 23, 0.98));
      border: 1px solid rgba(30, 64, 175, 0.3);
      box-shadow:
        0 16px 38px rgba(0, 0, 0, 0.75),
        inset 0 0 0 1px rgba(15, 23, 42, 0.95);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .right-col {
      flex: 1;
      padding: 14px 12px 12px 12px;
      border-radius: 20px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), #020617);
      border: 1px solid rgba(15, 23, 42, 0.95);
      box-shadow:
        0 16px 40px rgba(0, 0, 0, 0.85),
        inset 0 0 0 1px rgba(15, 23, 42, 0.98);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .pill-bar {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-muted);
      font-size: 11px;
      backdrop-filter: blur(14px);
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #22c55e, #14532d);
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.9);
    }

    .hero-title {
      margin-top: 8px;
      font-size: 24px;
      line-height: 1.32;
      font-weight: 650;
      letter-spacing: 0.01em;
      text-shadow:
        0 0 26px rgba(15, 23, 42, 1),
        0 0 18px rgba(0, 0, 0, 0.85);
    }

    .hero-title .clean {
      color: #22c55e;
    }

    .hero-title .toxic {
      color: var(--toxic);
    }

    .hero-sub {
      margin-top: 6px;
      font-size: 13px;
      color: var(--text-muted);
      max-width: 360px;
    }

    .mint-card {
      margin-top: 14px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.95), #020617);
      border-radius: 16px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      padding: 10px 10px 10px 10px;
      box-shadow:
        0 14px 30px rgba(0, 0, 0, 0.85),
        inset 0 0 0 1px rgba(15, 23, 42, 0.95);
    }

    .mint-head {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .mint-label {
      font-size: 12px;
      color: var(--text-main);
      font-weight: 500;
    }

    .mint-head span:last-child {
      font-size: 11px;
      color: var(--text-muted);
    }

    .mint-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .mint-input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), #020617);
      padding: 7px 11px;
      font-size: 12px;
      color: var(--text-main);
      outline: none;
      box-shadow:
        inset 0 0 0 1px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .mint-input::placeholder {
      color: rgba(148, 163, 184, 0.7);
    }

    .mint-input:focus {
      border-color: rgba(22, 242, 154, 0.9);
      box-shadow:
        0 0 0 1px rgba(22, 242, 154, 0.5),
        0 0 0 12px rgba(22, 242, 154, 0.04);
    }

    .btn-scan {
      border-radius: 999px;
      padding: 7px 14px;
      background: radial-gradient(circle at top left, #22c55e, #16a34a);
      border: 1px solid rgba(34, 197, 94, 0.9);
      color: #020617;
      font-weight: 600;
      font-size: 12px;
      cursor: pointer;
      box-shadow:
        0 12px 30px rgba(34, 197, 94, 0.45),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-scan:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    .mint-hint {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      margin-top: 7px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .hint-icon {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }

    .recent-wrap {
      margin-top: 10px;
      border-top: 1px dashed rgba(51, 65, 85, 0.9);
      padding-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .recent-label {
      font-size: 10px;
      color: rgba(148, 163, 184, 0.9);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .risk-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .risk-pill {
      border-radius: 999px;
      padding: 3px 7px;
      font-size: 10px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: rgba(148, 163, 184, 0.95);
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      transition: border-color 0.12s ease, background 0.12s ease, color 0.12s ease;
    }

    .risk-pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.8);
    }

    .risk-pill.safe {
      border-color: rgba(34, 197, 94, 0.9);
      color: #bbf7d0;
      background: rgba(22, 101, 52, 0.4);
    }

    .risk-pill.safe .risk-pill-dot {
      background: #22c55e;
    }

    .risk-pill.watch {
      border-color: rgba(234, 179, 8, 0.9);
      color: #fef9c3;
      background: rgba(113, 63, 18, 0.7);
    }

    .risk-pill.watch .risk-pill-dot {
      background: #eab308;
    }

    .risk-pill.risky {
      border-color: rgba(248, 113, 113, 0.9);
      color: #fecaca;
      background: rgba(153, 27, 27, 0.7);
    }

    .risk-pill.risky .risk-pill-dot {
      background: #ef4444;
    }

    .footer-note {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .footer-note a {
      color: #22c55e;
      text-decoration: none;
      font-weight: 500;
    }

    .footer-note a:hover {
      text-decoration: underline;
    }

    .hero-logo-wrapper {
      position: absolute;
      right: -10px;
      bottom: -10px;
      opacity: 0.12;
      pointer-events: none;
    }

    .hero-logo {
      width: 150px;
      height: auto;
      filter: drop-shadow(0 18px 32px rgba(0, 0, 0, 0.9));
    }

    .result-shell {
      flex: 1;
      border-radius: 18px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), #020617);
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 10px 10px 10px 10px;
      box-shadow:
        0 14px 34px rgba(0, 0, 0, 0.9),
        inset 0 0 0 1px rgba(15, 23, 42, 0.95);
      min-height: 210px;
    }

    .token-header {
      display: flex;
      gap: 10px;
    }

    .token-avatar {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      background: radial-gradient(circle at top left, #1e293b, #020617);
      border: 1px solid rgba(51, 65, 85, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
    }

    .token-avatar-inner {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      border: 1px solid rgba(15, 23, 42, 0.95);
    }

    .token-name-row {
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .token-title {
      font-size: 15px;
      font-weight: 600;
    }

    .token-symbol {
      font-size: 12px;
      color: var(--text-muted);
    }

    .token-subtitle {
      margin-top: 2px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .metrics-row {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 10px;
    }

    .metric {
      padding: 8px 8px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(31, 41, 55, 0.95);
    }

    .metric-label {
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 4px;
    }

    .metric-value {
      font-size: 13px;
      font-weight: 600;
    }

    .metric-sub {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .two-col {
      margin-top: 12px;
      display: grid;
      grid-template-columns: 1.05fr 1fr;
      gap: 10px;
    }

    .info-card {
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 8px 8px 8px 8px;
    }

    .section-heading {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(148, 163, 184, 0.9);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .section-pill {
      border-radius: 999px;
      padding: 2px 6px;
      font-size: 10px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(51, 65, 85, 0.9);
      color: rgba(148, 163, 184, 0.95);
    }

    .info-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 6px;
      font-size: 11px;
      gap: 8px;
    }

    .info-label {
      color: var(--text-muted);
    }

    .chip {
      border-radius: 999px;
      padding: 3px 7px;
      font-size: 10px;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .chip.good {
      border-color: rgba(34, 197, 94, 0.9);
      color: #bbf7d0;
      background: rgba(21, 128, 61, 0.5);
    }

    .chip.warn {
      border-color: rgba(234, 179, 8, 0.9);
      color: #fef9c3;
      background: rgba(113, 63, 18, 0.7);
    }

    .chip.bad {
      border-color: rgba(248, 113, 113, 0.95);
      color: #fecaca;
      background: rgba(127, 29, 29, 0.85);
    }

    .chip-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.9);
    }

    .chip.good .chip-dot {
      background: #22c55e;
    }

    .chip.warn .chip-dot {
      background: #eab308;
    }

    .chip.bad .chip-dot {
      background: #ef4444;
    }

    .link-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
    }

    .route-pill {
      border-radius: 999px;
      padding: 4px 8px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.98);
      color: rgba(209, 213, 219, 0.97);
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      text-decoration: none;
    }

    .route-pill span {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(148, 163, 184, 0.9);
    }

    .route-pill strong {
      font-size: 11px;
    }

    .jup-btn {
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid rgba(22, 242, 154, 0.9);
      background: rgba(22, 163, 74, 0.18);
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 7px;
      cursor: pointer;
      font-size: 11px;
    }

    /* üîµ Use real Jupiter logo instead of the green orb */
    .jup-icon {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background-image: url("/jupiter-logo.png"); /* put your logo in /public/jupiter-logo.png */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      box-shadow: 0 0 0 1px rgba(22, 242, 154, 0.85);
    }

    .error-box {
      margin-top: 6px;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid rgba(248, 113, 113, 0.95);
      background: rgba(127, 29, 29, 0.45);
      font-size: 12px;
      color: var(--danger);
      display: none;
    }

    @media (max-width: 880px) {
      .inner {
        flex-direction: column;
      }

      .left-col,
      .right-col {
        width: 100%;
      }

      .hero-logo-wrapper {
        display: none;
      }

      .two-col {
        grid-template-columns: 1fr;
      }

      .metrics-row {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
  </style>
</head>
<body>
<div class="glass-cracks-overlay"></div>
  <div class="app">
    <div class="frame">
      <div class="inner">
        <!-- LEFT SIDE -->
        <div class="left-col">
          <div>
            <div class="pill-bar">
              <span class="pill-dot"></span>
              <span>GlassBox v0.1</span>
              <span>Mint ¬∑ Freeze ¬∑ Holders ¬∑ Origin</span>
            </div>
            <div class="hero-title">
              Paste a Solana token mint.<br />
              See if it‚Äôs <span class="clean">clean</span> or <span class="toxic">toxic</span> in seconds.
            </div>
            <div class="hero-sub">
              No wallet connect. No signup. Just an instant on-chain safety read on any SPL token mint.
            </div>

            <div class="mint-card">
              <div class="mint-head">
                <span class="mint-label">Token mint address</span>
                <span>Solana SPL or Token-2022 mint</span>
              </div>
              <div class="mint-row">
                <input
                  id="mintInput"
                  class="mint-input"
                  type="text"
                  placeholder="Ex: EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1 (USDC)"
                />
                <button id="scanBtn" class="btn-scan">
                  <span id="scanBtnLabel">Scan</span>
                  <span id="scanBtnSpinner" style="display:none;">‚è≥</span>
                </button>
              </div>
              <div class="mint-hint">
                <div class="hint-icon">üîí</div>
                <div>We never see or store your wallet or keys. Only mint + public on-chain data.</div>
              </div>

              <!-- recent scans -->
              <div class="recent-wrap">
                <div class="recent-label">Recent scans</div>
                <div id="recentRow" class="risk-pills"></div>
              </div>
            </div>

            <div class="footer-note">
              Built for degen safety by
              <a href="https://x.com/Glassboxscans" target="_blank" rel="noopener noreferrer">@GlassBox</a>
            </div>
            <div class="hero-logo-wrapper">
              <img src="/glassbox-logo.png" alt="GlassBox logo" class="hero-logo" />
            </div>
          </div>
        </div>

        <!-- RIGHT SIDE -->
        <div class="right-col">
          <div class="result-shell">
            <div id="resultBox">
              <div style="font-size:12px;color:var(--text-muted);">
                Paste a Solana token mint on the left and hit <b>Scan</b> to see:
                <ul style="padding-left:18px;margin:4px 0;">
                  <li>Mint / freeze authority status</li>
                  <li>Holder concentration + insider clusters</li>
                  <li>Liquidity truth and lock % bands</li>
                  <li>Likely origin (Pump.fun, stables, etc.)</li>
                </ul>
                Then route to Jupiter, DexScreener, Axiom, Photon, BullX, Parde, Solpump, or Stalk.fun in one tap.
              </div>
            </div>
            <div id="errorBox" class="error-box"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ====== YOUR AFFILIATE / REF LINKS ====== */
    const JUP_REF   = "3Gkf49tYL3JNjawedx9HX94LbnSMQ6eTQLTR8i8rkxWG";
    const AXIOM_URL = "https://axiom.trade/@dudexyz";
    const BULLX_URL = "https://t.me/BullxBetaBot?start=access_N3OJF4TE16J";
    const PARDE_URL = "https://trade.padre.gg/rk/dudexyz";
    const PHOTON_URL = "https://photon-sol.tinyastro.io/@xyzthegod";
    const STALK_URL  = "https://stalk.fun/?r=ZATEZOJI";
    const SOLPUMP_URL = "https://solpump.io/a/DUDEXYZ";
    /* ========================================= */

    const API_BASE = "/api/check";

    const mintInput = document.getElementById("mintInput");
    const scanBtn = document.getElementById("scanBtn");
    const scanBtnLabel = document.getElementById("scanBtnLabel");
    const scanBtnSpinner = document.getElementById("scanBtnSpinner");
    const resultBox = document.getElementById("resultBox");
    const errorBox = document.getElementById("errorBox");
    const recentRow = document.getElementById("recentRow");

    const RECENT_KEY = "glassbox_recent_mints";
    const MAX_RECENT = 5;

    function setLoading(on) {
      if (on) {
        scanBtn.disabled = true;
        scanBtnLabel.textContent = "Scanning‚Ä¶";
        scanBtnSpinner.style.display = "inline";
      } else {
        scanBtn.disabled = false;
        scanBtnLabel.textContent = "Scan";
        scanBtnSpinner.style.display = "none";
      }
    }

    function shortAddr(addr) {
      if (!addr || addr.length <= 8) return addr || "";
      return addr.slice(0, 4) + "‚Ä¶" + addr.slice(-4);
    }

    function formatNumber(n) {
      if (n == null || isNaN(n)) return "‚Äî";
      const x = Number(n);
      if (x < 1000) return x.toFixed(0);
      if (x < 1_000_000) return (x / 1_000).toFixed(1) + "K";
      if (x < 1_000_000_000) return (x / 1_000_000).toFixed(1) + "M";
      return (x / 1_000_000_000).toFixed(1) + "B";
    }

    function formatUsd(v) {
      if (v == null || isNaN(v)) return "‚Äî";
      const n = Number(v);
      if (n <= 0) return "$0";
      if (n < 0.0001) {
        const s = n.toFixed(12);
        const parts = s.split(".");
        const dec = (parts[1] || "").replace(/0+$/, "");
        if (!dec) return "$0";
        let zeros = 0;
        let digits = "";
        for (const c of dec) {
          if (c === "0" && !digits) zeros++;
          else digits += c;
        }
        const sub = "‚ÇÄ‚ÇÅ‚ÇÇ‚ÇÉ‚ÇÑ‚ÇÖ‚ÇÜ‚Çá‚Çà‚Çâ".split("");
        const toSub = (num) =>
          String(num)
            .split("")
            .map((d) => sub[Number(d)] ?? d)
            .join("");
        return "$0.0" + toSub(zeros) + digits;
      }
      if (n < 1) return "$" + n.toFixed(6).replace(/0+$/, "").replace(/\.$/, "");
      if (n < 100) return "$" + n.toFixed(4).replace(/0+$/, "").replace(/\.$/, "");
      if (n < 1000) return "$" + n.toFixed(2);
      if (n < 1_000_000) return "$" + (n / 1_000).toFixed(1) + "K";
      if (n < 1_000_000_000) return "$" + (n / 1_000_000).toFixed(2) + "M";
      return "$" + (n / 1_000_000_000).toFixed(2) + "B";
    }

    // ‚úÖ FIXED: show minutes under 1 hour (no more "0H" for 9-minute coins)
    function formatAge(days) {
      if (days == null || isNaN(days) || days < 0) {
        return { main: "Unknown", sub: "" };
      }
      const totalMinutes = days * 24 * 60;
      if (totalMinutes < 60) {
        const mins = Math.max(1, Math.floor(totalMinutes));
        return { main: `${mins}m`, sub: "Under 1 hour old" };
      }
      const hours = totalMinutes / 60;
      if (hours < 24) {
        const h = Math.floor(hours);
        const m = Math.floor(totalMinutes - h * 60);
        return {
          main: `${h}h`,
          sub: m > 0 ? `${h}h ${m}m old` : `${h}h old`,
        };
      }
      const d = Math.floor(days);
      if (d < 30) {
        const remH = Math.floor(hours - d * 24);
        return {
          main: `${d}d`,
          sub: remH > 0 ? `${d}d ${remH}h old` : `${d}d old`,
        };
      }
      const months = Math.floor(d / 30);
      if (months < 12) {
        const remD = d - months * 30;
        return {
          main: `${months}mo`,
          sub: remD > 0 ? `${months}mo ${remD}d old` : `${months}mo old`,
        };
      }
      const years = Math.floor(d / 365);
      const remMo = Math.floor((d - years * 365) / 30);
      return {
        main: `${years}y`,
        sub: remMo > 0 ? `${years}y ${remMo}mo old` : `${years}y old`,
      };
    }

    function chipClass(level) {
      if (level === "good" || level === "low") return "chip good";
      if (level === "warn" || level === "medium") return "chip warn";
      if (level === "bad" || level === "high") return "chip bad";
      return "chip";
    }

    function saveRecent(mint, label, level) {
      try {
        const raw = localStorage.getItem(RECENT_KEY);
        let arr = [];
        if (raw) {
          arr = JSON.parse(raw);
          if (!Array.isArray(arr)) arr = [];
        }
        arr = arr.filter((x) => x.mint !== mint);
        arr.unshift({
          mint,
          label: label || "",
          level: level || "watch",
        });
        if (arr.length > MAX_RECENT) arr.length = MAX_RECENT;
        localStorage.setItem(RECENT_KEY, JSON.stringify(arr));
      } catch (e) {
        console.error("saveRecent error", e);
      }
    }

    function renderRecent() {
      recentRow.innerHTML = "";
      let arr = [];
      try {
        const raw = localStorage.getItem(RECENT_KEY);
        if (raw) arr = JSON.parse(raw);
        if (!Array.isArray(arr)) arr = [];
      } catch (e) {
        arr = [];
      }
      if (!arr.length) {
        return;
      }
      for (const item of arr) {
        const pill = document.createElement("div");
        pill.className = "risk-pill " + (item.level || "watch");
        pill.innerHTML = `
          <span class="risk-pill-dot"></span>
          <span>${item.label || shortAddr(item.mint)}</span>
          <span style="opacity:0.8;">¬∑</span>
          <span class="token-subtitle">${shortAddr(item.mint)}</span>
        `;
        pill.addEventListener("click", () => {
          mintInput.value = item.mint;
          onScan();
        });
        recentRow.appendChild(pill);
      }
    }

    function buildLinksRow(mint, dexStats, originHint) {
      const buttons = [];

      const jupUrl = `https://jup.ag/swap/SOL-${mint}?ref=${encodeURIComponent(JUP_REF)}`;
      buttons.push(`
        <button class="jup-btn" onclick="window.open('${jupUrl}','_blank')">
          <span class="jup-icon"></span>
          <span>Swap on Jupiter</span>
        </button>
      `);

      const dexUrl = `https://dexscreener.com/solana/${mint}`;
      buttons.push(`
        <button class="route-pill" onclick="window.open('${dexUrl}','_blank')">
          <span>DEX</span><strong>DexScreener</strong>
        </button>
      `);

      if (originHint?.label?.includes("Pump.fun")) {
        const pf = `https://pump.fun/coin/${mint}`;
        buttons.push(`
          <button class="route-pill" onclick="window.open('${pf}','_blank')">
            <span>ORIGIN</span><strong>Pump.fun</strong>
          </button>
        `);
      }

      buttons.push(`
        <button class="route-pill" onclick="window.open('${AXIOM_URL}/${mint}','_blank')">
          <span>FLOW</span><strong>Axiom</strong>
        </button>
      `);

      buttons.push(`
        <button class="route-pill" onclick="window.open('${PHOTON_URL}?token=${mint}','_blank')">
          <span>DEX</span><strong>Photon</strong>
        </button>
      `);

      buttons.push(`
        <button class="route-pill" onclick="window.open('${BULLX_URL}','_blank')">
          <span>TRADE</span><strong>BullX</strong>
        </button>
      `);

      buttons.push(`
        <button class="route-pill" onclick="window.open('${PARDE_URL}','_blank')">
          <span>TRADE</span><strong>Parde</strong>
        </button>
      `);

      buttons.push(`
        <button class="route-pill" onclick="window.open('${STALK_URL}','_blank')">
          <span>ALPHA</span><strong>Stalk.fun</strong>
        </button>
      `);

      buttons.push(`
        <button class="route-pill" onclick="window.open('${SOLPUMP_URL}','_blank')">
          <span>ALPHA</span><strong>Solpump</strong>
        </button>
      `);

      return `<div class="link-row">${buttons.join("")}</div>`;
    }

    function renderResult(data) {
      const {
        tokenMeta,
        mintInfo,
        holderSummary,
        insiderSummary,
        insiderClusters,
        originHint,
        riskSummary,
        tokenMetrics,
        tokenAge,
        liquidityTruth,
        socials,
        mintAuthority,
        freezeAuthority,
      } = data;

      const { mint, name, symbol, logoURI } = tokenMeta || {};

      const supplyHuman =
        mintInfo && mintInfo.supply && mintInfo.decimals != null
          ? Number(mintInfo.supply) / Math.pow(10, mintInfo.decimals)
          : null;

      const holdersCount = holderSummary?.holdersCount ?? null;
      const top10Pct = holderSummary?.top10Pct ?? null;
      const top10PctExLP = holderSummary?.top10PctExcludingLP ?? null;
      const lpHolder = holderSummary?.lpHolder ?? null;
      const topHolders = holderSummary?.topHolders || [];

      const insidersTotalPct = insiderSummary?.insidersTotalPct ?? null;
      const insiderWalletCount = insiderSummary?.insiderWalletCount ?? 0;

      const liqTruthLevel = liquidityTruth?.level;
      const liqTruthLabel = liquidityTruth?.label || "Unknown";
      const liqTruthNote = liquidityTruth?.note || "";
      const tradeToLiquidity = liquidityTruth?.tradeToLiquidity;
      const avgTradeUsd = liquidityTruth?.avgTradeUsd;
      const liqLockPercent = liquidityTruth?.lockPercent ?? null;

      const ageFmt = formatAge(tokenAge?.days);

      const score = typeof riskSummary?.score === "number" ? riskSummary.score : null;
      const riskLevel = riskSummary?.level || "unknown";

      const renouncedMint = mintAuthority != null
        ? !mintAuthority
        : mintInfo
        ? !mintInfo.mintAuthority
        : false;

      const canFreeze = freezeAuthority != null
        ? !!freezeAuthority
        : mintInfo
        ? !!mintInfo.freezeAuthority
        : false;

      let lockLabel = "Unknown";
      let lockChipClass = "chip warn";
      if (liqLockPercent != null && !isNaN(liqLockPercent)) {
        const p = liqLockPercent;
        lockLabel = p.toFixed(1) + "% in LP";
        if (p >= 90) lockChipClass = "chip good";
        else if (p >= 80) lockChipClass = "chip warn";
        else lockChipClass = "chip bad";
      }

      let holderRiskLabel = "Balanced";
      let holderChipClass = "chip good";
      if (top10PctExLP != null) {
        if (top10PctExLP > 60) {
          holderRiskLabel = "Concentrated / risky";
          holderChipClass = "chip bad";
        } else if (top10PctExLP > 35) {
          holderRiskLabel = "Top-heavy / watch";
          holderChipClass = "chip warn";
        }
      }

      const originLabel = originHint?.label || "Unknown origin";
      const originDetail = originHint?.detail || "";

      const routeLinks = buildLinksRow(mint, tokenMetrics, originHint);

      let holderRows = "";
      for (const h of topHolders) {
        const pct = h.pct != null ? h.pct.toFixed(2) + "%" : "‚Äî";
        holderRows += `
          <div class="info-row">
            <span class="info-label">${shortAddr(h.address)}</span>
            <span>${pct}</span>
          </div>
        `;
      }

      let socialsRow = "";
      if (socials) {
        const links = [];
        if (socials.website) links.push(`<a href="${socials.website}" target="_blank" rel="noopener noreferrer">Website</a>`);
        if (socials.twitter) links.push(`<a href="${socials.twitter}" target="_blank" rel="noopener noreferrer">Twitter</a>`);
        if (socials.telegram) links.push(`<a href="${socials.telegram}" target="_blank" rel="noopener noreferrer">Telegram</a>`);
        if (socials.discord) links.push(`<a href="${socials.discord}" target="_blank" rel="noopener noreferrer">Discord</a>`);
        if (links.length) {
          socialsRow = `
            <div class="info-row" style="margin-top:8px;font-size:11px;">
              <span class="info-label">Socials</span>
              <span style="display:flex;gap:6px;flex-wrap:wrap;">${links.join("")}</span>
            </div>
          `;
        }
      }

      const logoStyle = logoURI
        ? `style="background-image:url('${logoURI}');"`
        : "";

      resultBox.innerHTML = `
        <div class="token-header">
          <div class="token-avatar">
            <div class="token-avatar-inner" ${logoStyle}></div>
          </div>
          <div>
            <div class="token-name-row">
              <div class="token-title">${name || "Unknown Token"}</div>
              ${symbol ? `<span class="token-symbol">(${symbol})</span>` : ""}
            </div>
            <div class="token-subtitle">${shortAddr(mint)}</div>
          </div>
        </div>

        ${
          riskSummary?.blurb
            ? `<div class="token-subtitle" style="margin-top:2px;">${riskSummary.blurb}</div>`
            : ""
        }

        ${
          score !== null
            ? `
        <div style="margin:6px 0 4px 0;">
          <div style="display:flex;align-items:center;justify-content:space-between;font-size:11px;color:var(--text-muted);margin-bottom:2px;">
            <span>GlassBox scam score (0‚Äì100)</span>
            <span style="color:var(--accent);font-weight:600;">${score.toFixed(0)}/100</span>
          </div>
          <div style="height:6px;border-radius:999px;background:#020617;border:1px solid rgba(31,41,55,0.9);overflow:hidden;">
            <div style="height:100%;width:${score}%;background:linear-gradient(90deg,#22c55e,#eab308,#ef4444);"></div>
          </div>
        </div>
        `
            : ""
        }

        <div class="metrics-row">
          <div class="metric">
            <div class="metric-label">Price</div>
            <div class="metric-value">${formatUsd(tokenMetrics?.priceUsd)}</div>
          </div>
          <div class="metric">
            <div class="metric-label">Liquidity</div>
            <div class="metric-value">${formatUsd(tokenMetrics?.liquidityUsd)}</div>
          </div>
          <div class="metric">
            <div class="metric-label">Supply</div>
            <div class="metric-value">${
              supplyHuman != null ? formatNumber(supplyHuman) : "‚Äî"
            }</div>
          </div>
          <div class="metric">
            <div class="metric-label">Holders</div>
            <div class="metric-value">${
              holdersCount != null ? formatNumber(holdersCount) : "N/A"
            }</div>
            ${
              holdersCount == null
                ? `<div class="metric-sub">RPC limit / index missing</div>`
                : ""
            }
          </div>
          <div class="metric">
            <div class="metric-label">Token age</div>
            <div class="metric-value">${ageFmt.main}</div>
            ${ageFmt.sub ? `<div class="metric-sub">${ageFmt.sub}</div>` : ""}
          </div>
        </div>

        <div class="two-col">
          <div class="info-card">
            <div class="section-heading">
              <span>Token info</span>
            </div>
            <div class="info-row">
              <span class="info-label">Mint authority</span>
              <span class="${chipClass(renouncedMint ? "good" : "bad")}">
                ${renouncedMint ? "Renounced / disabled" : "Can still mint"}
              </span>
            </div>
            <div class="info-row">
              <span class="info-label">Freeze authority</span>
              <span class="${chipClass(canFreeze ? "bad" : "good")}">
                ${canFreeze ? "Can freeze wallets" : "None (cannot freeze)"}
              </span>
            </div>
            ${
              supplyHuman != null
                ? `
            <div class="info-row">
              <span class="info-label">Total supply</span>
              <span>${formatNumber(supplyHuman)}</span>
            </div>
            `
                : ""
            }
            ${socialsRow}
          </div>

          <div class="info-card">
            <div class="section-heading">
              <span>Liquidity truth</span>
              <span class="section-pill">${originLabel}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Quality</span>
              <span class="${chipClass(liqTruthLevel || "warn")}">
                <span class="chip-dot"></span>
                ${liqTruthLabel}
              </span>
            </div>
            <div class="info-row">
              <span class="info-label">Liquidity lock %</span>
              <span class="${lockChipClass}">
                <span class="chip-dot"></span>
                ${lockLabel}
              </span>
            </div>
            ${
              tradeToLiquidity != null
                ? `
            <div class="info-row">
              <span class="info-label">Vol / Liq (24h)</span>
              <span>${tradeToLiquidity.toFixed(1)}√ó</span>
            </div>
            `
                : ""
            }
            ${
              avgTradeUsd != null
                ? `
            <div class="info-row">
              <span class="info-label">Avg trade size (24h)</span>
              <span>${formatUsd(avgTradeUsd)}</span>
            </div>
            `
                : ""
            }
            ${
              liqTruthNote
                ? `<div class="metric-sub" style="margin-top:6px;">${liqTruthNote}</div>`
                : ""
            }
          </div>
        </div>

        <div class="two-col" style="margin-top:10px;">
          <div class="info-card">
            <div class="section-heading">
              <span>Holders</span>
              <span class="${holderChipClass}">
                <span class="chip-dot"></span>
                ${holderRiskLabel}
              </span>
            </div>
            <div class="info-row">
              <span class="info-label">Top 10 (incl. LP)</span>
              <span>${top10Pct != null ? top10Pct.toFixed(1) + "%" : "‚Äî"}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Top 10 (excl. LP)</span>
              <span>${top10PctExLP != null ? top10PctExLP.toFixed(1) + "%" : "‚Äî"}</span>
            </div>
            ${
              lpHolder
                ? `
            <div class="info-row">
              <span class="info-label">LP holder</span>
              <span>${shortAddr(lpHolder.address)} (${lpHolder.pct.toFixed(2)}%)</span>
            </div>
            `
                : ""
            }
            <div class="metric-sub" style="margin-top:6px;">
              We look at the top 10 wallets, LP holder, and insider clusters to estimate rug risk.
            </div>
          </div>

          <div class="info-card">
            <div class="section-heading">
              <span>Insiders &amp; clusters</span>
            </div>
            <div class="info-row">
              <span class="info-label">Insider concentration</span>
              <span class="${chipClass(insiderSummary?.riskLevel || "warn")}">
                <span class="chip-dot"></span>
                ${insidersTotalPct != null ? insidersTotalPct.toFixed(1) + "% of supply" : "Unknown"}
              </span>
            </div>
            <div class="info-row">
              <span class="info-label">Wallets ‚â•1%</span>
              <span>${insiderWalletCount}</span>
            </div>
            ${
              insiderClusters?.sampleCluster
                ? `
            <div class="info-row">
              <span class="info-label">${insiderClusters.sampleCluster.label}</span>
              <span>${insiderClusters.sampleCluster.leaderShort} (${insiderClusters.sampleCluster.pctOfSupply.toFixed(2)}%)</span>
            </div>
            `
                : ""
            }
            ${
              insiderSummary?.note
                ? `<div class="metric-sub" style="margin-top:6px;">${insiderSummary.note}</div>`
                : ""
            }
          </div>
        </div>

        <div class="info-card" style="margin-top:10px;">
          <div class="section-heading">
            <span>Routing &amp; tools</span>
          </div>
          ${routeLinks}
        </div>
      `;
    }

    async function onScan(event) {
      if (event) event.preventDefault();
      const mint = mintInput.value.trim();
      if (!mint) return;

      errorBox.style.display = "none";
      errorBox.textContent = "";
      setLoading(true);

      try {
        const res = await fetch(`${API_BASE}?mint=${encodeURIComponent(mint)}`);
        const json = await res.json();
        if (!res.ok) {
          throw new Error(json.error || `HTTP ${res.status}`);
        }
        renderResult(json);
        saveRecent(mint, json?.tokenMeta?.symbol || json?.tokenMeta?.name || "", json?.riskSummary?.level || "watch");
        renderRecent();
      } catch (err) {
        console.error("Scan error:", err);
        errorBox.style.display = "block";
        errorBox.textContent = err.message || "Something went wrong while scanning.";
      } finally {
        setLoading(false);
      }
    }

    scanBtn.addEventListener("click", onScan);
    mintInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") onScan(e);
    });

    window.addEventListener("load", () => {
      renderRecent();
    });
  </script>
</body>
</html>
