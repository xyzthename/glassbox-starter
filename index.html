<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlassBox ‚Äì Solana Token Risk Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --card: #020617;
      --accent: #16f29a;
      --accent-soft: rgba(22, 242, 154, 0.12);
      --border-subtle: rgba(148, 163, 184, 0.4);
      --border-strong: rgba(148, 163, 184, 0.9);
      --text-main: #e5e7eb;
      --text-muted: #64748b;
      --text-soft: #9ca3af;
      --danger: #ef4444;
      --danger-soft: rgba(239, 68, 68, 0.12);
      --warn: #eab308;
      --warn-soft: rgba(234, 179, 8, 0.12);
      --good: #22c55e;
      --good-soft: rgba(34, 197, 94, 0.12);
      --chip-bg: #020617;
      --chip-border: rgba(30, 64, 175, 1);
      --chip-text: #e5e7eb;
      --pill-safe: rgba(34, 197, 94, 0.15);
      --pill-risk: rgba(239, 68, 68, 0.18);
      --pill-watch: rgba(234, 179, 8, 0.15);
      --pill-safe-border: #22c55e;
      --pill-risk-border: #ef4444;
      --pill-watch-border: #eab308;
      --shadow-soft: 0 20px 50px rgba(15, 23, 42, 0.85);
      --shadow-subtle: 0 0 0 1px rgba(148, 163, 184, 0.18);
      --shadow-strong: 0 18px 45px rgba(15, 23, 42, 0.95);
      --card-radius: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Inter", sans-serif;
      background: radial-gradient(circle at top, #020617 0, #020617 48%, #000 100%);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .page {
      width: 100%;
      max-width: 1080px;
      margin: 0 auto;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(15, 118, 110, 0.24), transparent 52%),
        radial-gradient(circle at top right, rgba(37, 99, 235, 0.22), transparent 58%),
        rgba(15, 23, 42, 0.96);
      border-radius: var(--card-radius);
      box-shadow: var(--shadow-soft), var(--shadow-subtle);
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 18px 18px 18px;
      backdrop-filter: blur(18px);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 14px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title {
      font-size: 19px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .beta-pill {
      font-size: 10px;
      text-transform: uppercase;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--text-soft);
      background: rgba(15, 23, 42, 0.8);
    }

    .live-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      border-radius: 999px;
      padding: 3px 9px;
      border: 1px solid rgba(34, 197, 94, 0.7);
      background: rgba(22, 163, 74, 0.12);
      color: #bbf7d0;
    }

    .live-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.9);
      transition: opacity 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
    }

    .live-dot.off {
      background: #ef4444;
      box-shadow: 0 0 6px rgba(239, 68, 68, 0.7);
    }

    .scan-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .input-wrap {
      position: relative;
      flex: 1;
    }

    .input-label {
      position: absolute;
      top: 6px;
      left: 10px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .mint-input {
      width: 100%;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 20px 14px 6px;
      color: var(--text-main);
      outline: none;
      font-size: 13px;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    .mint-input::placeholder {
      color: rgba(148, 163, 184, 0.7);
      font-size: 12px;
    }

    .mint-input:focus {
      border-color: rgba(56, 189, 248, 0.9);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.3);
      background: rgba(15, 23, 42, 1);
    }

    .scan-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border-radius: 999px;
      border: 0;
      padding: 9px 16px;
      cursor: pointer;
      background: radial-gradient(circle at top left, #22c55e, #16a34a);
      color: #022c22;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      box-shadow: 0 12px 25px rgba(34, 197, 94, 0.45);
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease;
      white-space: nowrap;
    }

    .scan-btn:disabled {
      opacity: 0.7;
      cursor: default;
      box-shadow: none;
    }

    .scan-btn:not(:disabled):hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 35px rgba(34, 197, 94, 0.55);
    }

    .scan-btn:not(:disabled):active {
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(34, 197, 94, 0.4);
    }

    .scan-spinner {
      display: none;
      width: 11px;
      height: 11px;
      border-radius: 999px;
      border: 2px solid rgba(15, 23, 42, 0.4);
      border-top-color: #022c22;
      animation: spin 0.7s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .error-box {
      display: none;
      margin-bottom: 8px;
      font-size: 12px;
      color: #fecaca;
      background: rgba(127, 29, 29, 0.8);
      border-radius: 9px;
      padding: 6px 9px;
      border: 1px solid #fecaca;
    }

    .recent-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 16px;
      font-size: 11px;
    }

    .risk-pill {
      border-radius: 999px;
      border: 1px solid var(--pill-watch-border);
      background: var(--pill-watch);
      color: #fef9c3;
      padding: 4px 9px;
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .risk-pill.safe {
      border-color: var(--pill-safe-border);
      background: var(--pill-safe);
      color: #bbf7d0;
    }

    .risk-pill.risky {
      border-color: var(--pill-risk-border);
      background: var(--pill-risk);
      color: #fecaca;
    }

    .risk-pill.watch {
      border-color: var(--pill-watch-border);
      background: var(--pill-watch);
      color: #fef9c3;
    }

    .main-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      gap: 14px;
    }

    .left-col, .right-col {
      min-width: 0;
    }

    .risk-banner {
      border-radius: 14px;
      padding: 10px 12px;
      margin-bottom: 10px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.12), transparent 60%),
        radial-gradient(circle at top right, rgba(56, 189, 248, 0.12), transparent 60%),
        rgba(15, 23, 42, 0.96);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .risk-banner.low {
      border-color: rgba(34, 197, 94, 0.8);
      background: linear-gradient(135deg, rgba(22, 163, 74, 0.22), rgba(15, 23, 42, 0.96));
    }

    .risk-banner.medium {
      border-color: rgba(234, 179, 8, 0.8);
      background: linear-gradient(135deg, rgba(234, 179, 8, 0.22), rgba(15, 23, 42, 0.96));
    }

    .risk-banner.high {
      border-color: rgba(239, 68, 68, 0.9);
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.22), rgba(15, 23, 42, 0.96));
    }

    .risk-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .risk-main-top {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .risk-label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      opacity: 0.85;
    }

    .risk-score {
      font-size: 22px;
      font-weight: 700;
    }

    .risk-chip {
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--text-soft);
    }

    .risk-chip.low {
      border-color: rgba(34, 197, 94, 0.8);
      color: #bbf7d0;
      background: rgba(22, 163, 74, 0.16);
    }

    .risk-chip.high {
      border-color: rgba(239, 68, 68, 0.9);
      color: #fecaca;
      background: rgba(127, 29, 29, 0.6);
    }

    .risk-text {
      font-size: 12px;
      color: var(--text-soft);
      max-width: 460px;
    }

    .risk-axes {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 6px;
      font-size: 10px;
    }

    .axis-item {
      border-radius: 8px;
      padding: 5px 6px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(30, 64, 175, 0.75);
    }

    .axis-label {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .axis-score {
      font-size: 13px;
      font-weight: 600;
    }

    .token-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px dashed rgba(30, 64, 175, 0.7);
    }

    .token-logo {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      overflow: hidden;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, rgba(30, 64, 175, 0.26), #020617);
      font-size: 14px;
    }

    .token-logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .token-main {
      flex: 1;
      min-width: 0;
    }

    .token-name-row {
      display: flex;
      align-items: baseline;
      gap: 6px;
      margin-bottom: 2px;
    }

    .token-name {
      font-size: 15px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .token-symbol {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .token-mint {
      font-size: 11px;
      color: var(--text-soft);
      word-break: break-all;
    }

    .token-side {
      text-align: right;
      min-width: 120px;
    }

    .token-price {
      font-size: 14px;
      font-weight: 600;
    }

    .token-liq {
      font-size: 11px;
      color: var(--text-muted);
    }

    .metrics-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 10px;
    }

    .metric-box {
      border-radius: 10px;
      padding: 6px 7px;
      background: #020617;
      border: 1px solid rgba(30, 64, 175, 0.85);
    }

    .metric-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    .metric-value {
      font-size: 13px;
      font-weight: 600;
    }

    .metric-sub {
      margin-top: 1px;
      font-size: 10px;
      color: var(--text-soft);
    }

    .holders-box {
      border-radius: 10px;
      padding: 7px 8px;
      margin-bottom: 10px;
      background: #020617;
      border: 1px solid rgba(30, 64, 175, 0.85);
    }

    .section-heading {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-muted);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .info-note {
      font-size: 11px;
      color: var(--text-soft);
      line-height: 1.3;
    }

    .holder-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .holder-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 11px;
      text-decoration: none;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #e5e7eb;
      background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.25), transparent 55%),
        #020617;
    }

    .holder-pill.lp {
      border-color: rgba(56, 189, 248, 0.9);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5);
    }

    .origin-box {
      border-radius: 10px;
      padding: 7px 8px;
      margin-bottom: 10px;
      background: #020617;
      border: 1px solid rgba(30, 64, 175, 0.85);
    }

    .tools-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .tool-pill {
      font-size: 11px;
      border-radius: 999px;
      padding: 4px 8px;
      text-decoration: none;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.98);
      color: #e5e7eb;
    }

    .bottom-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 4px;
    }

    .btn-ghost {
      border-radius: 999px;
      padding: 4px 9px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.98);
      color: var(--text-soft);
      cursor: pointer;
    }

    .jup-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 5px 11px;
      font-size: 11px;
      border: 1px solid rgba(56, 189, 248, 0.85);
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.3), #020617);
      color: #e0f2fe;
      cursor: pointer;
    }

    .jup-icon {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-image: url("jupiter-logo.png"); /* put your Jupiter logo asset here */
    }

    .cluster-box {
      border-radius: 10px;
      padding: 7px 8px;
      margin-bottom: 10px;
      background: #020617;
      border: 1px solid rgba(30, 64, 175, 0.85);
    }

    .mayhem-timer {
      font-size: 11px;
      border-radius: 999px;
      padding: 2px 7px;
      border: 1px solid rgba(234, 179, 8, 0.9);
      color: #fef9c3;
      background: rgba(234, 179, 8, 0.18);
    }

    @media (max-width: 780px) {
      .main-layout {
        grid-template-columns: minmax(0, 1fr);
      }
      .card {
        padding: 14px 12px 14px;
      }
      .title {
        font-size: 17px;
      }
      .risk-axes {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 480px) {
      .scan-row {
        flex-direction: column;
        align-items: stretch;
      }
      .scan-btn {
        width: 100%;
        justify-content: center;
      }
      .bottom-row {
        flex-direction: column;
        align-items: stretch;
      }
      .bottom-row > div {
        width: 100%;
      }
      .jup-btn {
        justify-content: center;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <div class="card-header">
        <div class="title-block">
          <div class="title-row">
            <div class="title">GlassBox</div>
            <span class="beta-pill">Phase 1 ¬∑ Solana</span>
          </div>
          <div class="sub">Paste any Solana token mint ‚Üí get a fast rug-risk snapshot.</div>
        </div>
        <div class="live-pill">
          <div id="liveDot" class="live-dot"></div>
          <span>Backend status</span>
        </div>
      </div>

      <div class="scan-row">
        <div class="input-wrap">
          <div class="input-label">Solana token mint</div>
          <input
            id="mintInput"
            class="mint-input"
            placeholder="EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v (USDC) or any SPL token"
          />
        </div>
        <button id="scanBtn" class="scan-btn" type="button">
          <span id="scanBtnLabel">Scan</span>
          <div id="scanBtnSpinner" class="scan-spinner"></div>
        </button>
      </div>

      <div id="errorBox" class="error-box"></div>

      <div id="recentRow" class="recent-row"></div>

      <div class="main-layout">
        <div class="left-col">
          <div id="resultLeft">
            <div class="risk-banner">
              <div class="risk-main">
                <div class="risk-main-top">
                  <div class="risk-label">Overview</div>
                  <div class="risk-score">‚Äî</div>
                  <div class="risk-chip">No scan yet</div>
                </div>
                <div class="risk-text">
                  Paste a Solana mint above and hit Scan to see mint safety,
                  holder concentration, liquidity truth, and token age.
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="right-col">
          <div id="resultRight">
            <div class="holders-box">
              <div class="section-heading">Holder clusters</div>
              <div class="info-note">
                Holder & insider details will appear here after your first scan.
              </div>
            </div>
            <div class="origin-box">
              <div class="section-heading">
                <span id="originTitleText">TOKEN ORIGIN</span>
                <span id="originMayhemTimer" class="mayhem-timer" style="display:none;"></span>
              </div>
              <div class="info-note">
                Launch origin (Pump.fun, Mayhem, Raydium, etc.) will appear here after a scan.
              </div>
            </div>
            <div class="tools-row">
              <span class="tool-pill" style="opacity:0.6;">Tools unlock after your first scan.</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = "/api/check";

    const mintInput = document.getElementById("mintInput");
    const scanBtn = document.getElementById("scanBtn");
    const scanBtnLabel = document.getElementById("scanBtnLabel");
    const scanBtnSpinner = document.getElementById("scanBtnSpinner");
    const errorBox = document.getElementById("errorBox");
    const recentRow = document.getElementById("recentRow");
    const resultLeft = document.getElementById("resultLeft");
    const resultRight = document.getElementById("resultRight");

    const RECENT_KEY = "glassbox_recent_mints";
    const MAX_RECENT = 5;

    // Mayhem countdown interval holder
    let mayhemInterval = null;

    function setLoading(on) {
      if (on) {
        scanBtn.disabled = true;
        scanBtnLabel.textContent = "Scanning‚Ä¶";
        scanBtnSpinner.style.display = "inline";
      } else {
        scanBtn.disabled = false;
        scanBtnLabel.textContent = "Scan";
        scanBtnSpinner.style.display = "none";
      }
    }

    function shortAddr(addr) {
      if (!addr || addr.length <= 8) return addr || "";
      return addr.slice(0, 4) + "‚Ä¶" + addr.slice(-4);
    }

    function formatNumber(n) {
      if (n == null || isNaN(n)) return "‚Äî";
      const x = Number(n);
      if (x < 1000) return x.toFixed(0);
      if (x < 1_000_000) return (x / 1_000).toFixed(1) + "K";
      if (x < 1_000_000_000) return (x / 1_000_000).toFixed(1) + "M";
      return (x / 1_000_000_000).toFixed(1) + "B";
    }

    function formatUsd(v) {
      if (v == null || isNaN(v)) return "‚Äî";
      const n = Number(v);
      if (n <= 0) return "$0";
      if (n < 0.0001) {
        const s = n.toFixed(12);
        const parts = s.split(".");
        const dec = (parts[1] || "").replace(/0+$/, "");
        if (!dec) return "$0";
        let zeros = 0;
        let digits = "";
        for (const c of dec) {
          if (c === "0" && !digits) zeros++;
          else digits += c;
        }
        const sub = "‚ÇÄ‚ÇÅ‚ÇÇ‚ÇÉ‚ÇÑ‚ÇÖ‚ÇÜ‚Çá‚Çà‚Çâ".split("");
        const toSub = (num) =>
          String(num)
            .split("")
            .map((d) => sub[Number(d)] ?? d)
            .join("");
        return "$0.0" + toSub(zeros) + digits;
      }
      if (n < 1) return "$" + n.toFixed(6).replace(/0+$/, "").replace(/\.$/, "");
      if (n < 1000) return "$" + n.toFixed(4).replace(/0+$/, "").replace(/\.$/, "");
      if (n < 1_000_000) return "$" + n.toFixed(0);
      if (n < 1_000_000_000)
        return (
          "$" +
          (n / 1_000_000)
            .toFixed(2)
            .replace(/0+$/, "")
            .replace(/\.$/, "") +
          "M"
        );
      return (
        "$" +
        (n / 1_000_000_000)
          .toFixed(2)
          .replace(/0+$/, "")
          .replace(/\.$/, "") +
        "B"
      );
    }

    function formatAge(tokenAge) {
      const days = tokenAge?.ageDays;
      if (days == null || isNaN(days)) {
        return { main: "‚Äî", sub: "" };
      }
      const totalMinutes = Math.floor(days * 24 * 60);
      if (totalMinutes < 60) {
        const mins = Math.max(1, totalMinutes);
        return { main: mins + "m", sub: "since mint" };
      }
      const totalHours = Math.floor(days * 24);
      if (totalHours < 24) {
        return { main: totalHours + "h", sub: "since mint" };
      }
      if (days < 30) {
        const d = Math.floor(days);
        return { main: d + "d", sub: "since mint" };
      }
      if (days < 365) {
        const months = (days / 30).toFixed(1);
        return { main: months + "m", sub: "‚âà " + Math.floor(days) + " days" };
      }
      const years = (days / 365).toFixed(1);
      return { main: years + "y", sub: "‚âà " + Math.floor(days) + " days" };
    }

    function renderError(msg) {
      errorBox.style.display = "block";
      errorBox.textContent = msg || "Something went wrong.";
      updateLiveDot(false);
    }

    function clearError() {
      errorBox.style.display = "none";
      errorBox.textContent = "";
    }

    function bannerClass(level) {
      if (level === "low") return "risk-banner low";
      if (level === "high") return "risk-banner high";
      if (level === "medium") return "risk-banner medium";
      return "risk-banner";
    }

    function riskChipClass(level) {
      if (level === "low") return "risk-chip low";
      if (level === "high") return "risk-chip high";
      return "risk-chip";
    }

    function updateLiveDot(ok) {
      const el = document.getElementById("liveDot");
      if (!el) return;
      if (ok) el.classList.remove("off");
      else el.classList.add("off");
    }

    // recent history
    function saveRecentMint(mint, symbol, riskLevel) {
      try {
        const labelSymbol = (symbol || "").toUpperCase();
        const raw = localStorage.getItem(RECENT_KEY);
        let arr = [];
        if (raw) {
          arr = JSON.parse(raw);
          if (!Array.isArray(arr)) arr = [];
        }
        arr = arr.filter((i) => i.mint !== mint);
        arr.unshift({
          mint,
          symbol: labelSymbol,
          risk: riskLevel || "unknown",
        });
        if (arr.length > MAX_RECENT) arr = arr.slice(0, MAX_RECENT);
        localStorage.setItem(RECENT_KEY, JSON.stringify(arr));
        renderRecentMints(arr);
      } catch {}
    }

    function loadRecentMints() {
      try {
        const raw = localStorage.getItem(RECENT_KEY);
        if (!raw) {
          recentRow.innerHTML =
            '<span style="font-size:11px;color:var(--text-muted);">No scans yet.</span>';
          return;
        }
        const arr = JSON.parse(raw);
        if (!Array.isArray(arr) || !arr.length) {
          recentRow.innerHTML =
            '<span style="font-size:11px;color:var(--text-muted);">No scans yet.</span>';
          return;
        }
        renderRecentMints(arr);
      } catch {
        recentRow.innerHTML =
          '<span style="font-size:11px;color:var(--text-muted);">No scans yet.</span>';
      }
    }

    function renderRecentMints(arr) {
      if (!recentRow) return;
      if (!arr || !arr.length) {
        recentRow.innerHTML =
          '<span style="font-size:11px;color:var(--text-muted);">No scans yet.</span>';
        return;
      }
      recentRow.innerHTML = arr
        .map((item, idx) => {
          let cls = "risk-pill";
          if (item.risk === "high") cls += " risky";
          else if (item.risk === "low") cls += " safe";
          else cls += " watch";

          let riskLabel =
            item.risk === "high"
              ? "Risky"
              : item.risk === "low"
              ? "Safe"
              : "Watch";

          const label = item.symbol || (idx + 1) + " ¬∑ " + riskLabel;

          return `<button type="button" class="${cls}" data-mint="${item.mint}">
              ${label}
            </button>`;
        })
        .join("");
    }

    function render(data, mint) {
      const {
        tokenMeta,
        mintInfo,
        holderSummary,
        insiderSummary,
        originHint,
        mayhemMode,
        riskSummary,
        tokenMetrics,
        tokenAge,
        liquidityTruth,
        socials,
      } = data;

      const name = tokenMeta?.name || "Unknown Token";
      const symbol = tokenMeta?.symbol || "";
      const logoURI = tokenMeta?.logoURI || null;

      const priceUsd = tokenMetrics?.priceUsd ?? null;
      const liqUsd = tokenMetrics?.liquidityUsd ?? null;
      const dexFeesUsd24h = tokenMetrics?.dexFeesUsd24h ?? null;

      const ageFmt = formatAge(tokenAge);

      const liqTruthLabel = liquidityTruth?.label || "Unknown";
      const liqTruthNote = liquidityTruth?.note || "No liquidity pattern yet.";
      const tradeToLiquidity = liquidityTruth?.tradeToLiquidity ?? null;
      const avgTradeUsd = liquidityTruth?.avgTradeUsd ?? null;
      const vol24Usd = liquidityTruth?.volume24Usd ?? null;
      const tx24 = liquidityTruth?.txCount24 ?? null;

      const top10Pct = holderSummary?.top10Pct ?? null;
      const top10PctExLP = holderSummary?.top10PctExcludingLP ?? null;
      const topHolders = holderSummary?.topHolders || [];
      const lpHolder = holderSummary?.lpHolder || null;
      const holdersCount = holderSummary?.holdersCount ?? null;

      const insidersTotalPct = insiderSummary?.insidersTotalPct ?? null;
      const insiderWalletCount = insiderSummary?.insiderWalletCount ?? null;
      const whales = insiderSummary?.whales || [];
      const insiderRiskLevel = insiderSummary?.riskLevel || "low";
      const insiderNote = insiderSummary?.note || "";

      const score = riskSummary?.score ?? null;
      const riskLevel = riskSummary?.level || "medium";
      const riskBlurb = riskSummary?.blurb || "";

      const axes = riskSummary?.axes || {};
      const mintScore = axes.mintScore ?? null;
      const holderScore = axes.holderScore ?? null;
      const liqScore = axes.liqScore ?? null;
      const ageScore = axes.ageScore ?? null;

      const originLabel = originHint?.label || "Unknown origin";
      const originDetail = originHint?.detail || "";
      const originKey = originHint?.key || "unknown";

      // Choose a social link for the ghost button
      let socialUrl = null;
      let socialLabel = null;
      if (socials?.twitter) {
        socialUrl = socials.twitter;
        socialLabel = "Twitter / X";
      } else if (socials?.telegram) {
        socialUrl = socials.telegram;
        socialLabel = "Telegram";
      } else if (socials?.website) {
        socialUrl = socials.website;
        socialLabel = "Website";
      }

      // Jupiter URL (add your ?ref=code if needed)
      const jupUrl = "https://jup.ag/swap/SOL-" + encodeURIComponent(mint);

      const riskChipText =
        riskLevel === "low"
          ? "Safer-side degen"
          : riskLevel === "high"
          ? "Extreme risk"
          : "Mixed signals";

      const scoreText = score != null ? String(score) : "‚Äî";

      const ageSubText = ageFmt.sub || "";

      const liqTruthExtra = [];
      if (tradeToLiquidity != null)
        liqTruthExtra.push(
          "Vol/Liq: " + tradeToLiquidity.toFixed(1) + "√ó"
        );
      if (avgTradeUsd != null)
        liqTruthExtra.push("Avg trade: " + formatUsd(avgTradeUsd));
      if (vol24Usd != null)
        liqTruthExtra.push("24h vol: " + formatUsd(vol24Usd));
      if (tx24 != null) liqTruthExtra.push("24h trades: " + tx24);

      const liqTruthSub =
        liqTruthExtra.length ? liqTruthExtra.join(" ¬∑ ") : "";

      let clusterHeadline = "";
      if (insidersTotalPct != null && insiderWalletCount != null) {
        clusterHeadline =
          insidersTotalPct.toFixed(1) +
          "% held by " +
          insiderWalletCount +
          "+ insider wallets";
      } else {
        clusterHeadline = "Insider distribution data.";
      }

      const clusterRisk =
        insiderRiskLevel === "high"
          ? "High"
          : insiderRiskLevel === "medium"
          ? "Medium"
          : "Low";

      const whaleNote =
        whales && whales.length
          ? whales.length + " wallets hold ‚â•5% each."
          : "No ‚â•5% whale wallets detected (excluding LP).";

      // Holder bar visual
      const basePct = top10PctExLP ?? top10Pct ?? 0;
      const top10BarWidth = Math.max(0, Math.min(100, basePct));

      // === LEFT SIDE ===
      resultLeft.innerHTML = `
        <div class="${bannerClass(riskLevel)}">
          <div class="risk-main">
            <div class="risk-main-top">
              <div class="risk-label">GlassBox score</div>
              <div class="risk-score">${scoreText}</div>
              <div class="${riskChipClass(riskLevel)}">${riskChipText}</div>
            </div>
            <div class="risk-text">${riskBlurb}</div>
          </div>
          <div class="risk-axes">
            <div class="axis-item">
              <div class="axis-label">Mint safety</div>
              <div class="axis-score">${mintScore ?? "‚Äî"}</div>
            </div>
            <div class="axis-item">
              <div class="axis-label">Holders</div>
              <div class="axis-score">${holderScore ?? "‚Äî"}</div>
            </div>
            <div class="axis-item">
              <div class="axis-label">Liquidity truth</div>
              <div class="axis-score">${liqScore ?? "‚Äî"}</div>
            </div>
            <div class="axis-item">
              <div class="axis-label">Token age</div>
              <div class="axis-score">${ageScore ?? "‚Äî"}</div>
            </div>
          </div>
        </div>

        <div class="token-row">
          <div class="token-logo">
            ${
              logoURI
                ? `<img src="${logoURI}" alt="${symbol || name}" />`
                : (symbol || "?").slice(0, 3).toUpperCase()
            }
          </div>
          <div class="token-main">
            <div class="token-name-row">
              <div class="token-name">${name}</div>
              <div class="token-symbol">${symbol || ""}</div>
            </div>
            <div class="token-mint">${mint}</div>
          </div>
          <div class="token-side">
            <div class="token-price">${formatUsd(priceUsd)}</div>
            <div class="token-liq">Liq: ${formatUsd(liqUsd)}</div>
          </div>
        </div>

        <div class="metrics-row">
          <div class="metric-box">
            <div class="metric-label">Price (USD)</div>
            <div class="metric-value">${formatUsd(priceUsd)}</div>
            <div class="metric-sub">24h DEX fees (est.): ${formatUsd(
              dexFeesUsd24h
            )}</div>
          </div>
          <div class="metric-box">
            <div class="metric-label">Token age</div>
            <div class="metric-value">${ageFmt.main}</div>
            <div class="metric-sub">${ageSubText}</div>
          </div>
          <div class="metric-box">
            <div class="metric-label">Liquidity truth</div>
            <div class="metric-value">${liqTruthLabel}</div>
            <div class="metric-sub">${liqTruthSub || liqTruthNote}</div>
          </div>
        </div>

        <div class="metric-box">
          <div class="metric-label">Mint & freeze</div>
          <div class="metric-value">
            ${
              mintInfo
                ? (!mintInfo.mintAuthority && !mintInfo.freezeAuthority
                    ? "Mint + freeze fully renounced"
                    : !mintInfo.mintAuthority && mintInfo.freezeAuthority
                    ? "Mint renounced, freeze active"
                    : "Mint + freeze still active")
                : "‚Äî"
            }
          </div>
          <div class="metric-sub">
            ${
              mintInfo
                ? "Mint authority: " +
                  (mintInfo.mintAuthority ? "Active" : "Renounced") +
                  " ¬∑ Freeze: " +
                  (mintInfo.freezeAuthority ? "Active" : "None")
                : ""
            }
          </div>
        </div>
      `;

      // === RIGHT SIDE ===
      resultRight.innerHTML = `
        <div class="cluster-box">
          <div class="section-heading">Holder clusters & insiders</div>
          <div class="metric-value" style="font-size:12px;margin-bottom:4px;">
            ${
              insidersTotalPct != null
                ? insidersTotalPct.toFixed(1) +
                  "% of supply held by " +
                  (insiderWalletCount ?? "‚Äî") +
                  " insider wallets"
                : "Insider % not available."
            }
          </div>
          <div class="metric-sub" style="margin-bottom:4px;">
            Risk band: <b>${clusterRisk}</b>${
              holdersCount != null
                ? " ¬∑ " +
                  holdersCount.toLocaleString() +
                  " known holder accounts"
                : ""
            }
          </div>
          <div class="metric-sub" style="margin-bottom:4px;">${whaleNote}</div>
          <div class="info-note">${insiderNote}</div>
          ${
            top10PctExLP != null
              ? `
              <div style="margin-top:6px;font-size:10px;color:var(--text-muted);">
                ${top10PctExLP.toFixed(
                  1
                )}% held by top 10 non-LP wallets
              </div>
              <div style="margin-top:2px;height:4px;border-radius:999px;background:#020617;border:1px solid rgba(31,41,55,0.9);overflow:hidden;">
                <div style="height:100%;width:${top10BarWidth}%;background:linear-gradient(90deg,#22c55e,#eab308,#ef4444);"></div>
              </div>`
              : ""
          }
        </div>

        <div class="holders-box">
          <div class="section-heading">Top holders (LP + whales)</div>
          ${
            topHolders && topHolders.length
              ? `<div class="holder-list">
                  ${topHolders
                    .map((h, idx) => {
                      const isLp = lpHolder && lpHolder.address === h.address;
                      return `<a href="https://solscan.io/account/${h.address}"
                                target="_blank"
                                rel="noopener noreferrer"
                                class="holder-pill ${isLp ? "lp" : ""}">
                                ${String(idx + 1).padStart(
                                  2,
                                  "0"
                                )}. ${shortAddr(h.address)} ¬∑ ${h.pct.toFixed(
                        2
                      )}%${isLp ? " ¬∑ LP" : ""}
                              </a>`;
                    })
                    .join("")}
                </div>`
              : `<div class="info-note">Holder data not available for this mint.</div>`
          }
        </div>

        <div class="origin-box">
          <div class="section-heading">
            <span id="originTitleText">TOKEN ORIGIN</span>
            <span id="originMayhemTimer" class="mayhem-timer" style="display:none;"></span>
          </div>
          <div>
            <b>${originLabel}</b>${originDetail ? " ‚Äì " + originDetail : ""}
          </div>
        </div>

        <div class="tools-row">
          <a class="tool-pill" href="https://dexscreener.com/solana/${encodeURIComponent(
            mint
          )}" target="_blank" rel="noopener noreferrer">üìä DexScreener</a>
          <a class="tool-pill" href="https://axiom.trade/token/${encodeURIComponent(
            mint
          )}" target="_blank" rel="noopener noreferrer">üß† Axiom</a>
          <a class="tool-pill" href="https://photon-sol.tinyastro.io/en/lp/${encodeURIComponent(
            mint
          )}" target="_blank" rel="noopener noreferrer">‚ö° Photon</a>
          <a class="tool-pill" href="https://bullx.io/terminal?chainId=1399811149&address=${encodeURIComponent(
            mint
          )}" target="_blank" rel="noopener noreferrer">üêÇ BullX</a>
          <a class="tool-pill" href="https://padre.trade/token/${encodeURIComponent(
            mint
          )}" target="_blank" rel="noopener noreferrer">‚öôÔ∏è Padre</a>
          <a class="tool-pill" href="https://sol-pump.vercel.app/token/${encodeURIComponent(
            mint
          )}" target="_blank" rel="noopener noreferrer">üíß Solpump</a>
          <a class="tool-pill" href="https://stalk.fun/solana/${encodeURIComponent(
            mint
          )}" target="_blank" rel="noopener noreferrer">üïµÔ∏è Stalk.fun</a>
        </div>

        <div class="bottom-row">
          <div style="display:flex;gap:6px;flex-wrap:wrap;align-items:center;">
            <button id="copyMintBtn" class="btn-ghost">üìã Copy mint</button>
            <button id="copySummaryBtn" class="btn-ghost">üßæ Copy summary</button>
            ${
              socialLabel && socialUrl
                ? `<a href="${socialUrl}" target="_blank" rel="noopener noreferrer" class="btn-ghost">üì£ ${socialLabel}</a>`
                : ""
            }
          </div>
          <button id="jupBtn" class="jup-btn">
            <span class="jup-icon"></span>
            <span>Swap on Jupiter</span>
          </button>
        </div>
      `;

      updateLiveDot(true); // successful scan

      const jupBtn = document.getElementById("jupBtn");
      if (jupBtn) {
        jupBtn.onclick = () =>
          window.open(jupUrl, "_blank", "noopener,noreferrer");
      }

      const copyMintBtn = document.getElementById("copyMintBtn");
      if (copyMintBtn) {
        copyMintBtn.onclick = async () => {
          try {
            await navigator.clipboard.writeText(mint);
          } catch {}
        };
      }

      const copySummaryBtn = document.getElementById("copySummaryBtn");
      if (copySummaryBtn) {
        copySummaryBtn.onclick = async () => {
          const summary = `${name} (${symbol || "no symbol"})\nMint: ${mint}\nRisk: ${
            riskChipText
          }\nInsiders: ${
            insidersTotalPct != null
              ? insidersTotalPct.toFixed(1) + "%"
              : "N/A"
          }\nCluster: ${clusterRisk} ‚Äì ${clusterHeadline}`;
          try {
            await navigator.clipboard.writeText(summary);
          } catch {}
        };
      }

      // === Mayhem Mode UI (title + live countdown) ===
      const originTitleTextEl = document.getElementById("originTitleText");
      const originTimerEl = document.getElementById("originMayhemTimer");

      // Clear any previous countdown when we render a new token
      if (mayhemInterval) {
        clearInterval(mayhemInterval);
        mayhemInterval = null;
      }

      // 1) Derived Mayhem fallback (Pump.fun + very fresh)
      let derivedMayhem = null;
      if (
        originLabel.toLowerCase().includes("pump.fun") &&
        tokenAge &&
        typeof tokenAge.ageDays === "number"
      ) {
        const ageMinutes = tokenAge.ageDays * 24 * 60;
        const WINDOW_MINUTES = 30;
        if (ageMinutes >= 0 && ageMinutes < WINDOW_MINUTES) {
          const secondsLeft = Math.max(
            0,
            Math.round((WINDOW_MINUTES - ageMinutes) * 60)
          );
          derivedMayhem = {
            active: true,
            secondsRemaining: secondsLeft,
          };
        }
      }

      // 2) Prefer backend Mayhem if present
      const effectiveMayhem =
        mayhemMode && mayhemMode.active ? mayhemMode : derivedMayhem;

      if (originTitleTextEl && originTimerEl) {
        if (
          effectiveMayhem &&
          effectiveMayhem.active &&
          effectiveMayhem.secondsRemaining > 0
        ) {
          originTitleTextEl.textContent = "TOKEN ORIGIN ‚Äì Mayhem Mode";
          originTimerEl.style.display = "inline-block";

          let seconds = Math.floor(effectiveMayhem.secondsRemaining);

          function formatCountdown(sec) {
            const m = Math.floor(sec / 60);
            const s = sec % 60;
            const mm = String(m).padStart(2, "0");
            const ss = String(s).padStart(2, "0");
            return mm + ":" + ss;
          }

          function tick() {
            if (seconds <= 0) {
              originTimerEl.textContent = "ended";
              clearInterval(mayhemInterval);
              mayhemInterval = null;
              return;
            }
            originTimerEl.textContent = formatCountdown(seconds);
            seconds -= 1;
          }

          tick();
          mayhemInterval = setInterval(tick, 1000);
        } else {
          originTitleTextEl.textContent = "TOKEN ORIGIN";
          originTimerEl.style.display = "none";
          originTimerEl.textContent = "";
        }
      }

      saveRecentMint(mint, symbol, riskLevel);
    }

    async function handleScan() {
      const mint = (mintInput.value || "").trim();
      if (!mint) {
        renderError("Paste a valid Solana token mint address.");
        return;
      }
      clearError();
      setLoading(true);
      try {
        const res = await fetch(
          API_BASE + "?mint=" + encodeURIComponent(mint)
        );
        const data = await res.json();
        if (!res.ok) {
          throw new Error(data?.error || "Backend error");
        }
        render(data, mint);
      } catch (e) {
        console.error(e);
        renderError(e.message || "Failed to scan this mint.");
      } finally {
        setLoading(false);
      }
    }

    scanBtn.addEventListener("click", (e) => {
      e.preventDefault();
      handleScan();
    });

    mintInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        handleScan();
      }
    });

    if (recentRow) {
      recentRow.addEventListener("click", (e) => {
        const pill = e.target.closest(".risk-pill");
        if (!pill) return;
        const mint = pill.dataset.mint;
        if (!mint) return;
        mintInput.value = mint;
        handleScan();
      });
    }

    loadRecentMints();
  </script>
</body>
</html>
