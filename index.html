<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Glassbox ‚Äì Solana Rug Checker</title>
  <style>
    :root {
      --bg: #050508;
      --card: #111119;
      --accent: #00ff9a;
      --accent-soft: rgba(0, 255, 154, 0.1);
      --danger: #ff3b81;
      --text-main: #f9f9ff;
      --text-muted: #a0a0b8;
      --border: #262638;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #1a1a2e 0, #050508 55%);
      color: var(--text-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }
    .shell {
      width: 100%;
      max-width: 760px;
      padding: 32px 20px;
    }
    .card {
      background: linear-gradient(145deg, #111119, #0a0a10);
      border-radius: 24px;
      padding: 32px 28px 24px;
      border: 1px solid var(--border);
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(
        circle at top left,
        rgba(0, 255, 154, 0.12),
        transparent 55%
      );
      opacity: 0.7;
      pointer-events: none;
    }
    .card-inner {
      position: relative;
      z-index: 1;
    }
    h1 {
      margin: 0 0 4px;
      font-size: 2.4rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }
    .subtitle {
      margin: 0 0 20px;
      color: var(--text-muted);
      font-size: 0.98rem;
      max-width: 520px;
    }
    .pill-row {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(5, 5, 20, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 18px;
    }
    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(0, 255, 154, 0.9);
    }
    .form-row {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }
    .form-row input {
      flex: 1;
      padding: 13px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #05050b;
      color: var(--text-main);
      font-size: 0.95rem;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }
    .form-row input::placeholder {
      color: #5f6078;
    }
    .form-row input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
      background: #070713;
    }
    .form-row button {
      white-space: nowrap;
      padding: 13px 18px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      background: var(--accent);
      color: #02020a;
      box-shadow: 0 10px 30px rgba(0, 255, 154, 0.25);
      transition: transform 0.1s, box-shadow 0.1s, filter 0.1s;
    }
    .form-row button:hover {
      transform: translateY(-1px);
      filter: brightness(1.03);
      box-shadow: 0 16px 40px rgba(0, 255, 154, 0.3);
    }
    .form-row button:active {
      transform: translateY(0);
      box-shadow: 0 6px 16px rgba(0, 255, 154, 0.2);
    }
    .helper {
      margin-top: 8px;
      font-size: 0.78rem;
      color: var(--text-muted);
      text-align: left;
    }
    .helper span {
      color: var(--accent);
    }
    .result {
      margin-top: 24px;
      padding: 18px 16px 14px;
      border-radius: 18px;
      background: #05050b;
      border: 1px dashed var(--border);
      min-height: 110px;
      text-align: left;
      position: relative;
      overflow: hidden;
    }
    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.72rem;
      margin-bottom: 6px;
    }
    .tag-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
    }
    .tag.low {
      background: rgba(0, 255, 154, 0.08);
      color: var(--accent);
    }
    .tag.low .tag-dot {
      background: var(--accent);
      box-shadow: 0 0 10px rgba(0, 255, 154, 0.9);
    }
    .tag.high {
      background: rgba(255, 59, 129, 0.08);
      color: var(--danger);
    }
    .tag.high .tag-dot {
      background: var(--danger);
      box-shadow: 0 0 10px rgba(255, 59, 129, 0.9);
    }
    .tag.info {
      background: rgba(255, 255, 255, 0.04);
      color: var(--text-muted);
    }
    .tag.info .tag-dot {
      background: #f1c40f;
      box-shadow: 0 0 10px rgba(241, 196, 15, 0.7);
    }
    .result-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 1rem;
    }
    .result-text {
      font-size: 0.9rem;
      color: var(--text-muted);
    }
    .result-small {
      margin-top: 8px;
      font-size: 0.78rem;
      color: #686a86;
    }
    .result-section-wrap {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 14px;
      margin-top: 12px;
    }
    .result-section {
      padding: 10px 10px 8px;
      border-radius: 12px;
      background: rgba(10, 10, 20, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.03);
    }
    .result-section h3 {
      margin: 0 0 4px;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }
    .result-section p {
      margin: 0;
      font-size: 0.82rem;
      color: var(--text-main);
    }
    .badge {
      display: inline-block;
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 0.7rem;
      margin-top: 4px;
    }
    .badge.green {
      background: rgba(0, 255, 154, 0.12);
      color: var(--accent);
    }
    .badge.red {
      background: rgba(255, 59, 129, 0.12);
      color: var(--danger);
    }
    .badge.gray {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-muted);
    }
    .holder-list {
      margin-top: 4px;
      font-size: 0.78rem;
      color: var(--text-muted);
    }
    .holder-list div {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .token-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 8px 0 10px;
    }
    .token-logo {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      object-fit: cover;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: #0b0b14;
    }
    .token-title-main {
      font-weight: 600;
      font-size: 0.95rem;
    }
    .token-title-symbol {
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    .token-stats {
      margin-top: 4px;
      font-size: 0.78rem;
      color: #999bbc;
    }
    .actions-row {
      margin-top: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    .btn-secondary {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(5, 5, 15, 0.95);
      color: var(--text-main);
      font-size: 0.8rem;
      text-decoration: none;
      cursor: pointer;
    }
    .btn-secondary:hover {
      border-color: var(--accent);
    }
    .footer {
      margin-top: 14px;
      font-size: 0.76rem;
      color: var(--text-muted);
      text-align: left;
      opacity: 0.9;
    }
    .footer strong {
      color: var(--accent);
      font-weight: 500;
    }
    @media (max-width: 640px) {
      .card {
        padding: 24px 18px 20px;
      }
      .form-row {
        flex-direction: column;
      }
      .form-row button {
        width: 100%;
      }
      .result-section-wrap {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="card">
      <div class="card-inner">
        <div class="pill-row">
          <span class="pill-dot"></span>
          Live Solana mint authority scanner ¬∑ v0.1
        </div>

        <h1>GLASSBOX</h1>
        <p class="subtitle">
          Check if a token‚Äôs mint authority is renounced before you ape. No wallet
          connect, no signup, just on-chain facts.
        </p>

        <div class="form-row">
          <input
            id="mintInput"
            type="text"
            spellcheck="false"
            placeholder="Paste a Solana token mint or token account (e.g. EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v)"
          />
          <button id="checkBtn">Check Token</button>
        </div>
        <div class="helper">
          Tip: grab the <span>mint</span> from Solscan / Dexscreener / Birdeye. If
          you paste a token account, Glassbox will hop to its mint.
        </div>

        <div id="result" class="result">
          <div class="tag info">
            <span class="tag-dot"></span>
            <span>Status ¬∑ Waiting for input</span>
          </div>
          <div class="result-title">No token checked yet.</div>
          <div class="result-text">
            Paste any Solana token mint above and hit ‚ÄúCheck Token‚Äù to see whether
            the dev can still print supply.
          </div>
        </div>

        <div class="footer">
          Built in public by <strong>you</strong>. This is not financial advice ‚Äî
          just raw mint authority + holder data from Solana via Helius.
        </div>
      </div>
    </div>
  </div>

  <script>
    const resultBox = document.getElementById("result");
    const inputEl = document.getElementById("mintInput");
    const btnEl = document.getElementById("checkBtn");

    function showIdle() {
      resultBox.innerHTML = `
        <div class="tag info">
          <span class="tag-dot"></span>
          <span>Status ¬∑ Waiting for input</span>
        </div>
        <div class="result-title">No token checked yet.</div>
        <div class="result-text">
          Paste any Solana token mint above and hit ‚ÄúCheck Token‚Äù to see whether
          the dev can still print supply.
        </div>
      `;
    }

    function showLoading() {
      resultBox.innerHTML = `
        <div class="tag info">
          <span class="tag-dot"></span>
          <span>Querying Solana‚Ä¶</span>
        </div>
        <div class="result-title">Checking mint authority on-chain.</div>
        <div class="result-text">
          Talking to the Glassbox node. This usually takes under a second.
        </div>
      `;
    }

    function showError(message) {
      resultBox.innerHTML = `
        <div class="tag high">
          <span class="tag-dot"></span>
          <span>Error</span>
        </div>
        <div class="result-title">Couldn‚Äôt read that mint.</div>
        <div class="result-text">${message}</div>
      `;
    }

    showIdle();

    function formatPercent(x) {
      if (isNaN(x)) return "0.00";
      return x.toFixed(2);
    }

    async function handleCheck() {
      const mint = inputEl.value.trim();
      if (!mint) {
        showError("Paste a Solana token mint or token account first.");
        return;
      }

      showLoading();

      try {
        const res = await fetch(`/api/check?mint=${encodeURIComponent(mint)}`);
        const data = await res.json();

        if (!res.ok || !data.ok) {
          showError(data.message || "Unknown error from backend.");
          return;
        }

        const {
          mint: canonicalMint,
          riskMint,
          mintAuthority,
          freezeAuthority,
          freezeAuthorityOption,
          holders,
          metadata,
          decimals,
          supply,
        } = data;

        const isLow = riskMint === "LOW";
        const tagClass = isLow ? "low" : "high";
        const title =
          riskMint === "LOW"
            ? "üü¢ Low rug risk from mint side."
            : "üî¥ High rug risk from mint side.";
        const line =
          riskMint === "LOW"
            ? "This mint has no active authority. The dev cannot print new tokens from the mint, which removes one of the biggest rug vectors."
            : "This mint still has an active authority. The dev (or whoever controls it) can mint new tokens and nuke the chart at any time.";

        const freezeText =
          freezeAuthorityOption === 0
            ? "No freeze authority set. Tokens cannot be globally frozen from the mint."
            : freezeAuthority
            ? `Freeze authority is active. Authority address: ${freezeAuthority}`
            : "Freeze authority exists, but address could not be decoded.";

        const freezeBadge =
          freezeAuthorityOption === 0
            ? '<span class="badge green">No freeze authority</span>'
            : '<span class="badge red">Freeze authority active</span>';

        // Holder summary
        let holderSummary = "Holder data not available.";
        let holderBadge = '<span class="badge gray">Snapshot unavailable</span>';
        let holderLines = "";

        if (holders && holders.top && holders.top.length > 0) {
          const top1 = holders.top1;
          const top10 = holders.top10;
          holderSummary = `Top 1 wallet holds ~${formatPercent(
            top1
          )}% of supply. Top 10 wallets hold ~${formatPercent(
            top10
          )}% of supply.`;

          if (top1 > 50 || top10 > 70) {
            holderBadge =
              '<span class="badge red">Very concentrated</span>';
          } else {
            holderBadge =
              '<span class="badge green">Reasonable distribution</span>';
          }

          const preview = holders.top.slice(0, 3);
          preview.forEach((h) => {
            holderLines += `<div>#${h.rank}: ${formatPercent(
              h.percent
            )}% ¬∑ ${h.address}</div>`;
          });
        }

        // Token details
        const tokenName = metadata?.name || "Unknown token";
        const tokenSymbol = metadata?.symbol || "";
        const tokenImage = metadata?.image || null;

        const supplyText = supply
          ? `${supply} (raw, decimals: ${decimals ?? "?"})`
          : "Unknown";

        const jupUrl = `https://jup.ag/swap/SOL-${canonicalMint}`;

        resultBox.innerHTML = `
          <div class="tag ${tagClass}">
            <span class="tag-dot"></span>
            <span>Mint authority ${isLow ? "renounced" : "active"}</span>
          </div>

          <div class="token-header">
            ${
              tokenImage
                ? `<img src="${tokenImage}" alt="token logo" class="token-logo" />`
                : `<div class="token-logo"></div>`
            }
            <div>
              <div class="token-title-main">${tokenName}</div>
              <div class="token-title-symbol">${
                tokenSymbol ? tokenSymbol : ""
              }</div>
            </div>
          </div>

          <div class="token-stats">
            Mint: <code>${canonicalMint}</code><br/>
            Total supply (raw): ${supplyText}
          </div>

          <div class="result-title" style="margin-top:10px;">${title}</div>
          <div class="result-text">${line}</div>

          <div class="result-section-wrap">
            <div class="result-section">
              <h3>Mint controls</h3>
              <p>${freezeText}</p>
              ${freezeBadge}
              ${
                mintAuthority
                  ? `<div class="result-small" style="margin-top:6px;">Mint authority: <code>${mintAuthority}</code></div>`
                  : ""
              }
            </div>
            <div class="result-section">
              <h3>Holders snapshot</h3>
              <p>${holderSummary}</p>
              ${holderBadge}
              <div class="holder-list">${holderLines}</div>
            </div>
          </div>

          <div class="result-section" style="margin-top:10px;">
            <h3>Origin signal</h3>
            <p>Pump.fun origin detection coming soon. For now, verify contract and socials manually.</p>
          </div>

          <div class="actions-row">
            <a href="${jupUrl}" target="_blank" rel="noopener noreferrer" class="btn-secondary">
              üîÅ Open in Jupiter (swap)
            </a>
            <button class="btn-secondary" type="button" id="copyMintBtn">
              üìã Copy mint address
            </button>
          </div>
        `;

        const copyBtn = document.getElementById("copyMintBtn");
        if (copyBtn) {
          copyBtn.addEventListener("click", async () => {
            try {
              await navigator.clipboard.writeText(canonicalMint);
              copyBtn.textContent = "‚úÖ Mint copied";
              setTimeout(() => {
                copyBtn.textContent = "üìã Copy mint address";
              }, 1500);
            } catch {
              alert("Could not copy mint to clipboard.");
            }
          });
        }
      } catch (err) {
        console.error(err);
        showError("Network error. Try again in a few seconds.");
      }
    }

    btnEl.addEventListener("click", handleCheck);
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") handleCheck();
    });
  </script>
</body>
</html>
