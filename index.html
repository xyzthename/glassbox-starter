<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlassBox – Solana mint safety scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050712;
      --card: #0b101c;
      --card-soft: #101626;
      --accent: #00ff95;
      --accent-soft: rgba(0, 255, 149, 0.12);
      --danger: #ff4b5c;
      --warn: #ffb020;
      --muted: #a9b5d9;
      --border-subtle: rgba(255, 255, 255, 0.06);
      --pill-bg: #141b2d;
      --scam-grad: linear-gradient(90deg, #ff4b5c 0%, #ffb020 50%, #00c853 100%);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Inter", sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font-main);
      background: radial-gradient(circle at top, #161b2f 0, #050712 55%);
      color: #f6f7ff;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page {
      width: 100%;
      max-width: 1200px;
      padding: 40px 24px;
    }

    .shell {
      background: radial-gradient(circle at top left, #171f35 0, #050712 55%);
      border-radius: 28px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 24px 80px rgba(0, 0, 0, 0.75);
      padding: 28px 32px 32px;
      display: grid;
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 1fr);
      gap: 24px;
    }

    @media (max-width: 900px) {
      .shell {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .subbadge-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(6, 10, 24, 0.92);
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #1dd75b;
      box-shadow: 0 0 0 4px rgba(29, 215, 91, 0.18);
    }

    .pill-link {
      color: var(--accent);
      text-decoration: none;
    }

    .pill-link:hover {
      text-decoration: underline;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 32px;
      letter-spacing: 0.04em;
    }

    .headline-highlight {
      color: var(--accent);
    }

    .hero-sub {
      margin: 0 0 20px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }

    .hero-sub ul {
      padding-left: 16px;
      margin: 10px 0 0;
    }

    .hero-sub li {
      margin: 4px 0;
    }

    .input-card {
      margin-top: 24px;
      background: rgba(5, 8, 20, 0.9);
      border-radius: 18px;
      padding: 18px 18px 16px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 18px 55px rgba(0, 0, 0, 0.6);
    }

    .label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    form {
      display: flex;
      gap: 10px;
    }

    .mint-input {
      flex: 1;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: #050814;
      color: #f6f7ff;
      font-size: 13px;
      outline: none;
    }

    .mint-input::placeholder {
      color: #646f92;
    }

    .scan-btn {
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #00ff95, #39ffce);
      color: #020308;
      padding: 10px 24px;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.4),
        0 16px 40px rgba(0, 0, 0, 0.75);
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .scan-btn[disabled] {
      opacity: 0.7;
      cursor: default;
      box-shadow: none;
    }

    .tiny-hint {
      margin-top: 10px;
      font-size: 11px;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(8, 12, 28, 0.85);
      border: 1px dashed rgba(255, 255, 255, 0.06);
    }

    .tiny-hint i {
      font-style: normal;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.05);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: var(--accent);
    }

    .recent-row {
      margin-top: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
    }

    .recent-empty {
      color: var(--muted);
      opacity: 0.9;
    }

    .recent-pill {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: var(--pill-bg);
      padding: 5px 10px;
      cursor: pointer;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .recent-pill span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--muted);
    }

    .recent-low span.dot {
      background: #00c853;
    }
    .recent-medium span.dot {
      background: #ffb020;
    }
    .recent-high span.dot {
      background: #ff4b5c;
    }

    .made-by {
      margin-top: 14px;
      font-size: 11px;
      color: var(--muted);
    }

    .made-by a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
    }

    .made-by a:hover {
      text-decoration: underline;
    }

    /* RIGHT SIDE */

    .result-card {
      background: rgba(5, 9, 22, 0.96);
      border-radius: 22px;
      padding: 18px 18px 18px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 22px 65px rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: flex-start;
    }

    .risk-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .risk-pill-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: #ff4b5c;
    }

    .risk-low {
      background: rgba(0, 200, 83, 0.08);
      color: #7fffb5;
    }
    .risk-low .risk-pill-dot {
      background: #00c853;
      box-shadow: 0 0 0 3px rgba(0, 200, 83, 0.2);
    }

    .risk-medium {
      background: rgba(255, 176, 32, 0.1);
      color: #ffd27b;
    }
    .risk-medium .risk-pill-dot {
      background: #ffb020;
      box-shadow: 0 0 0 3px rgba(255, 176, 32, 0.2);
    }

    .risk-high {
      background: rgba(255, 75, 92, 0.12);
      color: #ff9ba8;
    }
    .risk-high .risk-pill-dot {
      background: #ff4b5c;
      box-shadow: 0 0 0 3px rgba(255, 75, 92, 0.2);
    }

    .tiny-label {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 2px;
    }

    .token-row {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .token-avatar {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #ffffff 0, #ffb020 35%, #7a3cff 100%);
      flex-shrink: 0;
      overflow: hidden;
    }

    .token-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .token-main {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .token-name-line {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: baseline;
    }

    .token-name {
      font-weight: 600;
      font-size: 14px;
    }

    .token-symbol {
      font-size: 12px;
      color: var(--muted);
    }

    .token-mint {
      font-size: 11px;
      color: var(--muted);
      opacity: 0.9;
    }

    .live-tag {
      font-size: 11px;
      color: var(--muted);
    }

    .scam-bar-block {
      margin-top: 8px;
    }

    .scam-label-row {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .scam-bar {
      position: relative;
      height: 6px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.04);
      overflow: hidden;
    }

    .scam-fill {
      height: 100%;
      width: 35%;
      background-image: var(--scam-grad);
      border-radius: inherit;
      transition: width 0.35s ease-out;
    }

    .scam-score-text {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }

    .result-body {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 12px;
    }

    @media (max-width: 900px) {
      .result-body {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .result-section {
      background: var(--card-soft);
      border-radius: 16px;
      padding: 12px 12px 11px;
      border: 1px solid var(--border-subtle);
      font-size: 12px;
    }

    .result-section h3 {
      margin: 0 0 8px;
      font-size: 11px;
      letter-spacing: 0.09em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-top: 4px;
    }

    .result-label {
      color: var(--muted);
      font-size: 11px;
    }

    .badge {
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 11px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(8, 13, 32, 0.9);
      white-space: nowrap;
    }

    .badge-good {
      background: rgba(0, 200, 83, 0.12);
      color: #7fffb5;
      border-color: rgba(0, 200, 83, 0.35);
    }

    .badge-none {
      background: rgba(255, 255, 255, 0.04);
      color: var(--muted);
    }

    .badge-warn {
      background: rgba(255, 176, 32, 0.12);
      color: #ffd27b;
      border-color: rgba(255, 176, 32, 0.35);
    }

    .badge-bad {
      background: rgba(255, 75, 92, 0.12);
      color: #ff9ba8;
      border-color: rgba(255, 75, 92, 0.35);
    }

    .result-small {
      margin-top: 8px;
      font-size: 11px;
      color: var(--muted);
      line-height: 1.45;
    }

    .holder-bar {
      position: relative;
      height: 6px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.05);
      overflow: hidden;
      margin-top: 4px;
    }

    .holder-fill {
      height: 100%;
      width: 0%;
      border-radius: inherit;
      background: linear-gradient(90deg, #00c853, #ffb020, #ff4b5c);
      transform-origin: left center;
      transition: width 0.35s ease-out;
    }

    .holder-summary {
      margin-top: 4px;
      font-size: 11px;
      color: var(--muted);
    }

    .holder-list {
      margin-top: 8px;
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 6px;
    }

    .holder-pill {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      padding: 5px 8px;
      border-radius: 999px;
      background: #141b2d;
      border: 1px solid rgba(255, 255, 255, 0.06);
      color: #d2daf6;
      text-decoration: none;
    }

    .holder-left {
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 0;
    }

    .holder-rank {
      font-size: 10px;
      color: var(--muted);
      flex-shrink: 0;
    }

    .holder-addr {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 180px;
    }

    .holder-pct {
      font-weight: 500;
      flex-shrink: 0;
    }

    @media (max-width: 900px) {
      .holder-addr {
        max-width: 140px;
      }
    }

    .origin-body {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }

    .origin-label {
      color: #f6f7ff;
      font-weight: 500;
    }

    .tools-row {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tool-pill {
      border-radius: 999px;
      padding: 5px 10px;
      font-size: 11px;
      color: #d2daf6;
      background: #141b2d;
      border: 1px solid rgba(255, 255, 255, 0.08);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .tool-pill-icon {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #00ff95;
    }

    .footnote {
      margin-top: 8px;
      font-size: 10px;
      color: var(--muted);
      opacity: 0.9;
    }

    .bottom-row {
      margin-top: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--muted);
      gap: 12px;
    }

    .bottom-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .ghost-btn {
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(10, 14, 30, 0.95);
      color: #f6f7ff;
      font-size: 11px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .copy-btn {
      border-radius: 999px;
      padding: 6px 11px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(10, 14, 30, 0.95);
      color: #f6f7ff;
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="shell">
      <!-- LEFT: INPUT -->
      <section>
        <div class="subbadge-row">
          <div class="pill">
            <span class="pill-dot"></span>
            GlassBox v0.1 · Mint · Freeze · Holders · Origin
          </div>
          <span class="pill" style="border-style:dashed;">
            No wallet. No signup. Just raw on-chain data.
          </span>
        </div>

        <h1>Paste a Solana token mint.<br />See if it’s <span class="headline-highlight">clean or toxic</span> in seconds.</h1>

        <div class="hero-sub">
          <div>No wallet connect, no API key, no drama. Paste any SPL mint and get:</div>
          <ul>
            <li>Mint &amp; freeze authority status.</li>
            <li>Top-holder concentration with clickable Solscan links.</li>
            <li>Simple 0–100 GlassBox scam score bar.</li>
          </ul>
        </div>

        <div class="input-card">
          <div class="label-row">
            <span>TOKEN MINT ADDRESS</span>
            <span style="color:var(--muted);">Solana SPL or Token-2022 mint</span>
          </div>

          <form id="scan-form">
            <input
              id="mint-input"
              class="mint-input"
              type="text"
              autocomplete="off"
              placeholder="Eg. DeZxAZ8z7PrnnR… (BONK mint)"
            />
            <button id="scan-btn" class="scan-btn" type="submit">
              <span>Scan</span>
            </button>
          </form>

          <div class="tiny-hint">
            <i>!</i>
            <span>We never see or store your wallet or keys. This is a read-only explorer.</span>
          </div>

          <div class="recent-row" id="recent-tokens">
            <span class="recent-empty">Scan a token to start building your list of “USDC · Safe / BEAR · Very risky”.</span>
          </div>
        </div>

        <div class="made-by">
          Built for degen safety by <a href="https://x.com" target="_blank" rel="noreferrer">@yourhandle</a>.
        </div>
      </section>

      <!-- RIGHT: RESULTS -->
      <section>
        <div class="result-card" id="result-box">
          <!-- filled by JS -->
        </div>
      </section>
    </div>
  </div>

  <script>
    const mintInput = document.getElementById("mint-input");
    const scanBtn = document.getElementById("scan-btn");
    const form = document.getElementById("scan-form");
    const resultBox = document.getElementById("result-box");
    const recentContainer = document.getElementById("recent-tokens");
    const RECENT_KEY = "glassbox_recent_tokens_v1";

    function escapeHtml(str) {
      return String(str || "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function shortAddr(addr) {
      if (!addr || addr.length <= 8) return addr;
      return addr.slice(0, 4) + "…" + addr.slice(-4);
    }

    function formatPct(num) {
      if (num === null || num === undefined || isNaN(num)) return "0%";
      if (num >= 10) return num.toFixed(1) + "%";
      return num.toFixed(2) + "%";
    }

    function riskToLabel(level) {
      if (level === "low") return "Safe";
      if (level === "high") return "Very risky";
      return "Caution";
    }

    function riskToClass(level) {
      if (level === "low") return "risk-low";
      if (level === "high") return "risk-high";
      return "risk-medium";
    }

    function renderRecentTokens(list) {
      recentContainer.innerHTML = "";
      if (!list || !list.length) {
        recentContainer.innerHTML =
          '<span class="recent-empty">Scan a token to start building your list of “USDC · Safe / BEAR · Very risky”.</span>';
        return;
      }

      list.forEach((t) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = `recent-pill recent-${t.level || "medium"}`;
        btn.dataset.mint = t.mint;
        btn.innerHTML =
          '<span class="dot"></span>' +
          escapeHtml(t.symbol || "Token") +
          " · " +
          escapeHtml(t.riskLabel || riskToLabel(t.level));
        btn.addEventListener("click", () => {
          mintInput.value = t.mint;
          runScan();
        });
        recentContainer.appendChild(btn);
      });
    }

    function saveRecentToken(mint, tokenMeta, riskSummary) {
      const symbol =
        tokenMeta.symbol ||
        tokenMeta.name ||
        (mint.length > 6 ? mint.slice(0, 4) + "…" + mint.slice(-4) : mint);
      const level = riskSummary.level || "medium";
      const riskLabel = riskToLabel(level);

      let list = [];
      try {
        list = JSON.parse(localStorage.getItem(RECENT_KEY) || "[]");
      } catch (e) {
        list = [];
      }

      list = list.filter((t) => t.mint !== mint);
      list.unshift({ mint, symbol, level, riskLabel });
      if (list.length > 5) list.length = 5;

      localStorage.setItem(RECENT_KEY, JSON.stringify(list));
      renderRecentTokens(list);
    }

    function loadRecent() {
      try {
        const list = JSON.parse(localStorage.getItem(RECENT_KEY) || "[]");
        renderRecentTokens(list);
      } catch (e) {
        renderRecentTokens([]);
      }
    }

    function renderInitialCard() {
      resultBox.innerHTML = `
        <div class="result-header">
          <div>
            <div class="risk-pill risk-medium">
              <span class="risk-pill-dot"></span>
              <span>Unknown risk</span>
            </div>
            <div class="token-row" style="margin-top:8px;">
              <div class="token-avatar"></div>
              <div class="token-main">
                <div class="token-name-line">
                  <span class="token-name">Unknown Token</span>
                </div>
                <div class="token-mint">Paste a mint on the left to run your first scan.</div>
              </div>
            </div>
          </div>
          <div class="live-tag">Live on-chain scan</div>
        </div>

        <div class="scam-bar-block">
          <div class="scam-label-row">
            <span>GlassBox scam score (0–100)</span>
            <span>—</span>
          </div>
          <div class="scam-bar">
            <div class="scam-fill" style="width: 0%;"></div>
          </div>
          <div class="scam-score-text">
            We’ll color this bar from red → green once you scan a mint.
          </div>
        </div>

        <div class="result-body">
          <div class="result-section">
            <h3>Mint &amp; freeze controls</h3>
            <div class="result-row">
              <span class="result-label">Mint authority</span>
              <span class="badge badge-none">Unknown</span>
            </div>
            <div class="result-row">
              <span class="result-label">Freeze authority</span>
              <span class="badge badge-none">Unknown</span>
            </div>
            <div class="result-row">
              <span class="result-label">Locked / burned</span>
              <span class="badge badge-none">N/A (indexer data soon)</span>
            </div>
            <div class="result-row">
              <span class="result-label">DEX listing / boost</span>
              <span class="badge badge-none">N/A (Dexscreener soon)</span>
            </div>
            <div class="result-small">
              Once you scan, we’ll show whether the mint or freeze authority can still rug you,
              plus a quick view of locked / burned supply and DEX boost status.
            </div>
          </div>

          <div class="result-section">
            <h3>Holder risk</h3>
            <div class="result-row">
              <span class="result-label">Top 10 wallets</span>
              <span class="badge badge-none">—</span>
            </div>
            <div class="holder-bar">
              <div class="holder-fill" style="width: 0%;"></div>
            </div>
            <div class="holder-summary">
              Holder concentration will show here after your first scan.
            </div>
            <div class="holder-list">
            </div>
          </div>
        </div>

        <div class="result-section">
          <h3>Origin signal</h3>
          <div class="origin-body">
            <span class="origin-label">Unknown protocol / origin.</span>
            <span>We’ll try to tag Pump.fun style mints and other protocol fingerprints as we go.</span>
          </div>

          <div class="tools-row" style="margin-top:10px;">
            <span class="result-label">Tools</span>
          </div>
          <div class="tools-row">
            <a class="tool-pill" href="https://dexscreener.com/solana" target="_blank" rel="noreferrer">
              <span class="tool-pill-icon"></span> DexScreener
            </a>
            <a class="tool-pill" href="https://axiom.trade/@dudexyz" target="_blank" rel="noreferrer">
              <span class="tool-pill-icon"></span> Axiom
            </a>
            <a class="tool-pill" href="https://t.me/BullxBetaBot?start=access_N3OJF4TE16J" target="_blank" rel="noreferrer">
              <span class="tool-pill-icon"></span> BullX Bot
            </a>
            <a class="tool-pill" href="https://trade.padre.gg/rk/dudexyz" target="_blank" rel="noreferrer">
              <span class="tool-pill-icon"></span> Padre
            </a>
            <a class="tool-pill" href="https://photon-sol.tinyastro.io/@xyzthegod" target="_blank" rel="noreferrer">
              <span class="tool-pill-icon"></span> Photon
            </a>
            <a class="tool-pill" href="https://stalk.fun/?r=ZATEZOJI" target="_blank" rel="noreferrer">
              <span class="tool-pill-icon"></span> StalkFun
            </a>
          </div>

          <div class="footnote">
            These are your referral links. Using them supports GlassBox at no extra cost to the user.
            GlassBox Pro (degen alerts &amp; MEV shield) coming soon.
          </div>

          <div class="bottom-row">
            <div class="bottom-actions">
              <a class="ghost-btn" id="swap-btn" href="https://jup.ag" target="_blank" rel="noreferrer">
                Swap on Jupiter
              </a>
            </div>
            <button class="copy-btn" id="copy-btn" type="button">
              <span>Copy mint</span>
            </button>
          </div>
        </div>
      `;
    }

    async function runScan() {
      const mint = (mintInput.value || "").trim();
      if (!mint) return;

      scanBtn.disabled = true;
      scanBtn.textContent = "Scanning…";

      try {
        const res = await fetch(`/api/check?mint=${encodeURIComponent(mint)}`);
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }
        const data = await res.json();
        if (data.error) {
          throw new Error(data.error);
        }

        const { tokenMeta, mintAuthority, freezeAuthority, holderSummary, originHint, riskSummary } =
          data;

        const level = riskSummary?.level || "medium";
        const score = typeof riskSummary?.score === "number" ? riskSummary.score : 50;
        const blurb = riskSummary?.blurb || "";

        const holders = holderSummary?.topHolders || [];
        const top10Pct = holderSummary?.top10Pct || 0;

        const riskClass = riskToClass(level);
        const riskLabel = level === "low" ? "Low rug risk" : level === "high" ? "High rug risk" : "Medium risk";

        const name = tokenMeta?.name || "Unknown Token";
        const symbol = tokenMeta?.symbol || "";
        const logoURI = tokenMeta?.logoURI || null;

        const originLabel = originHint?.label || "Unknown protocol / origin";
        const originDetail = originHint?.detail || "";

        const dexScreenerUrl = `https://dexscreener.com/solana/${encodeURIComponent(mint)}`;
        const jupUrl = `https://jup.ag/swap/SOL-${encodeURIComponent(mint)}`;

        // Build holders list HTML
        let holdersHtml = "";
        holders.forEach((h, idx) => {
          const rank = (idx + 1).toString().padStart(2, "0") + ".";
          const pctText = formatPct(h.pct || 0);
          const addrShort = shortAddr(h.address);
          const solscanUrl = `https://solscan.io/account/${encodeURIComponent(h.address)}?cluster=mainnet`;

          holdersHtml += `
            <a class="holder-pill" href="${solscanUrl}" target="_blank" rel="noreferrer">
              <div class="holder-left">
                <span class="holder-rank">${rank}</span>
                <span class="holder-addr">${escapeHtml(addrShort)}</span>
              </div>
              <span class="holder-pct">${pctText}</span>
            </a>
          `;
        });

        if (!holdersHtml) {
          holdersHtml =
            '<div class="holder-summary">No holder data from RPC yet. This usually means the token is extremely new or illiquid.</div>';
        }

        const top10PctText = formatPct(top10Pct);

        const mintBadgeClass = mintAuthority ? "badge-bad" : "badge-good";
        const mintBadgeText = mintAuthority ? "Active" : "Renounced / disabled";

        const freezeBadgeClass = freezeAuthority ? "badge-warn" : "badge-good";
        const freezeBadgeText = freezeAuthority ? "Active" : "None";

        resultBox.innerHTML = `
          <div class="result-header">
            <div>
              <div class="risk-pill ${riskClass}">
                <span class="risk-pill-dot"></span>
                <span>${escapeHtml(riskLabel)}</span>
              </div>

              <div class="token-row" style="margin-top:8px;">
                <div class="token-avatar">
                  ${
                    logoURI
                      ? `<img src="${escapeHtml(logoURI)}" alt="logo" />`
                      : ""
                  }
                </div>
                <div class="token-main">
                  <div class="token-name-line">
                    <span class="token-name">${escapeHtml(name)}</span>
                    ${
                      symbol
                        ? `<span class="token-symbol">(${escapeHtml(
                            symbol
                          )})</span>`
                        : ""
                    }
                  </div>
                  <div class="token-mint">${escapeHtml(mint)}</div>
                  <div class="result-small" style="margin-top:4px;">
                    ${escapeHtml(blurb)}
                  </div>
                </div>
              </div>
            </div>
            <div class="live-tag">Live on-chain scan</div>
          </div>

          <div class="scam-bar-block">
            <div class="scam-label-row">
              <span>GlassBox scam score (0–100)</span>
              <span>${score}/100</span>
            </div>
            <div class="scam-bar">
              <div class="scam-fill" style="width:${Math.max(
                0,
                Math.min(score, 100)
              )}%;"></div>
            </div>
            <div class="scam-score-text">
              Higher is better. We combine mint authority, freeze authority, and holder concentration into a simple bar.
            </div>
          </div>

          <div class="result-body">
            <div class="result-section">
              <h3>Mint &amp; freeze controls</h3>
              <div class="result-row">
                <span class="result-label">Mint authority</span>
                <span class="badge ${mintBadgeClass}">${mintBadgeText}</span>
              </div>
              <div class="result-row">
                <span class="result-label">Freeze authority</span>
                <span class="badge ${freezeBadgeClass}">${freezeBadgeText}</span>
              </div>
              <div class="result-row">
                <span class="result-label">Locked / burned</span>
                <span class="badge badge-none">N/A (indexer data soon)</span>
              </div>
              <div class="result-row">
                <span class="result-label">DEX listing / boost</span>
                <span class="badge badge-none">N/A (Dexscreener soon)</span>
              </div>
              <div class="result-small">
                If <strong>mint</strong> is active, devs can still print more tokens.
                If <strong>freeze</strong> is active, tokens in certain wallets can be locked.
              </div>
            </div>

            <div class="result-section">
              <h3>Holder risk</h3>
              <div class="result-row">
                <span class="result-label">Top 10 wallets</span>
                <span class="badge badge-none">${top10PctText} of supply</span>
              </div>
              <div class="holder-bar">
                <div class="holder-fill" style="width:${Math.max(
                  0,
                  Math.min(top10Pct, 100)
                )}%;"></div>
              </div>
              <div class="holder-summary">
                ${
                  holders.length
                    ? `${top10PctText} held by top 10 wallets (excluding known pool contracts).`
                    : "No holder data yet from RPC."
                }
              </div>
              <div class="holder-list">
                ${holdersHtml}
              </div>
            </div>
          </div>

          <div class="result-section">
            <h3>Origin signal</h3>
            <div class="origin-body">
              <span class="origin-label">${escapeHtml(originLabel)}.</span>
              <span>${escapeHtml(originDetail)}</span>
            </div>

            <div class="tools-row" style="margin-top:10px;">
              <span class="result-label">Tools</span>
            </div>
            <div class="tools-row">
              <a class="tool-pill" href="${dexScreenerUrl}" target="_blank" rel="noreferrer">
                <span class="tool-pill-icon"></span> DexScreener
              </a>
              <a class="tool-pill" href="https://axiom.trade/@dudexyz" target="_blank" rel="noreferrer">
                <span class="tool-pill-icon"></span> Axiom
              </a>
              <a class="tool-pill" href="https://t.me/BullxBetaBot?start=access_N3OJF4TE16J" target="_blank" rel="noreferrer">
                <span class="tool-pill-icon"></span> BullX Bot
              </a>
              <a class="tool-pill" href="https://trade.padre.gg/rk/dudexyz" target="_blank" rel="noreferrer">
                <span class="tool-pill-icon"></span> Padre
              </a>
              <a class="tool-pill" href="https://photon-sol.tinyastro.io/@xyzthegod" target="_blank" rel="noreferrer">
                <span class="tool-pill-icon"></span> Photon
              </a>
              <a class="tool-pill" href="https://stalk.fun/?r=ZATEZOJI" target="_blank" rel="noreferrer">
                <span class="tool-pill-icon"></span> StalkFun
              </a>
            </div>

            <div class="footnote">
              These are your referral links. Using them supports GlassBox at no extra cost to the user.
              GlassBox Pro (degen alerts &amp; MEV shield) coming soon.
            </div>

            <div class="bottom-row">
              <div class="bottom-actions">
                <a class="ghost-btn" id="swap-btn" href="${jupUrl}" target="_blank" rel="noreferrer">
                  Swap on Jupiter
                </a>
              </div>
              <button class="copy-btn" id="copy-btn" type="button">
                <span>Copy mint</span>
              </button>
            </div>
          </div>
        `;

        // copy button + swap link already wired via HTML above
        const copyBtn = document.getElementById("copy-btn");
        if (copyBtn) {
          copyBtn.addEventListener("click", async () => {
            try {
              await navigator.clipboard.writeText(mint);
              copyBtn.textContent = "Copied!";
              setTimeout(() => (copyBtn.textContent = "Copy mint"), 1200);
            } catch (e) {
              alert("Could not copy to clipboard.");
            }
          });
        }

        // store in "last 5 scanned"
        saveRecentToken(mint, tokenMeta || {}, riskSummary || {});
      } catch (err) {
        console.error(err);
        resultBox.innerHTML = `
          <div class="result-header">
            <div>
              <div class="risk-pill risk-high">
                <span class="risk-pill-dot"></span>
                <span>Error</span>
              </div>
              <div class="token-row" style="margin-top:8px;">
                <div class="token-main">
                  <div class="token-name-line">
                    <span class="token-name">Couldn’t scan that mint.</span>
                  </div>
                  <div class="result-small" style="margin-top:4px;">
                    ${
                      err && err.message
                        ? escapeHtml(err.message)
                        : "Unknown error from RPC or API."
                    }
                  </div>
                </div>
              </div>
            </div>
            <div class="live-tag">RPC error</div>
          </div>
        `;
      } finally {
        scanBtn.disabled = false;
        scanBtn.textContent = "Scan";
      }
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      runScan();
    });

    // Initial render
    renderInitialCard();
    loadRecent();
  </script>
</body>
</html>
