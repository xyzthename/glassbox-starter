<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glassbox ‚Äì Instant Solana Rug Checker</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 40px;
            background: #000;
            color: #fff;
            margin: 0;
        }

        h1 {
            font-size: 3.5em;
            margin-bottom: 10px;
        }

        p {
            margin: 0.3rem 0;
        }

        input {
            width: 100%;
            max-width: 600px;
            padding: 16px;
            font-size: 18px;
            border-radius: 12px;
            border: 1px solid #444;
            background: #111;
            color: #fff;
            margin: 20px auto;
            display: block;
        }

        button {
            padding: 16px 40px;
            background: #00ff88;
            color: #000;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
        }

        #result {
            margin: 40px auto;
            padding: 30px;
            border-radius: 16px;
            max-width: 600px;
            background: #111;
            border: 2px solid #333;
            min-height: 120px;
            font-size: 18px;
            line-height: 1.5;
        }
    </style>
</head>
<body>

    <h1>Glassbox</h1>
    <p>Paste any Solana token address ‚Üí instant rug risk check (100% free)</p>

    <input id="tokenInput" type="text"
           placeholder="e.g. EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v (USDC)">
    <button onclick="checkToken()">Check Token Now</button>

    <div id="result"></div>

    <script>
        // Public demo RPC (QuickNode docs endpoint ‚Äì no key required)
        const RPC_URL = "https://docs-demo.solana-mainnet.quiknode.pro/";

        async function rpcCall(method, params, id = 1) {
            const resp = await fetch(RPC_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    jsonrpc: "2.0",
                    id,
                    method,
                    params
                })
            });

            if (!resp.ok) {
                throw new Error("HTTP error " + resp.status);
            }

            const data = await resp.json();
            console.log("RPC", method, "‚Üí", data); // helpful for debugging in DevTools
            if (data.error) {
                throw new Error(data.error.message || "RPC error");
            }
            return data.result;
        }

        async function checkToken() {
            const resultDiv = document.getElementById("result");
            let address = document.getElementById("tokenInput").value.trim();

            if (!address) {
                resultDiv.innerHTML = "<p style='color:#ff0066;'>Paste a token mint or token account first.</p>";
                return;
            }

            resultDiv.innerHTML = "<p>Checking Solana mainnet‚Ä¶</p>";

            try {
                // 1Ô∏è‚É£ First lookup ‚Äì see what kind of account this is
                const infoResult = await rpcCall("getAccountInfo", [
                    address,
                    { encoding: "jsonParsed" }
                ], 1);

                const account = infoResult.value;

                if (!account) {
                    resultDiv.innerHTML =
                        "<p style='color:#ff0066;'>Invalid address ‚Äî no account exists at this pubkey.</p>";
                    return;
                }

                const ownerProgram = account.owner;
                const parsed = account.data && account.data.parsed ? account.data.parsed : null;
                const parsedType = parsed ? parsed.type : null;
                const parsedInfo = parsed ? parsed.info || {} : {};

                // SPL Token program IDs
                const TOKEN_PROGRAM = "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA";
                const TOKEN_2022_PROGRAM = "TokenzQdGq8cYk6TKfNfGKEbDU9zG6GbdsuUuWg2u7W";

                // If this is a token *account*, get its mint then check that mint
                if (parsedType === "account" && parsedInfo.mint) {
                    const mintAddress = parsedInfo.mint;

                    resultDiv.innerHTML =
                        `<p style="color:#ffaa00;">Detected token account ‚Üí checking mint: ${mintAddress}</p>`;

                    await checkMintAuthority(mintAddress, resultDiv);
                    return;
                }

                // If this looks like a mint (owned by token program), treat it as a mint
                if (ownerProgram === TOKEN_PROGRAM || ownerProgram === TOKEN_2022_PROGRAM) {
                    await checkMintAuthority(address, resultDiv, parsedType, parsedInfo);
                    return;
                }

                // Anything else: valid account, but not a token mint / token account
                resultDiv.innerHTML = `
                    <p style="color:#ffaa00;">Valid Solana account, but not an SPL token mint or token account.</p>
                    <p>Owner program: <code>${ownerProgram}</code></p>
                `;
            } catch (err) {
                console.error(err);
                resultDiv.innerHTML =
                    `<p style="color:#ff0066;">Network / RPC error. Open DevTools ‚Üí Console to see details.</p>`;
            }
        }

        async function checkMintAuthority(mintAddress, resultDiv, parsedType = null, parsedInfo = null) {
            // If we already have parsed mint info from the first call, reuse it.
            let mintParsedType = parsedType;
            let mintParsedInfo = parsedInfo;

            if (!mintParsedInfo || mintParsedType !== "mint") {
                // 2Ô∏è‚É£ Fetch mint account info specifically
                const mintResult = await rpcCall("getAccountInfo", [
                    mintAddress,
                    { encoding: "jsonParsed" }
                ], 2);

                if (!mintResult.value) {
                    resultDiv.innerHTML =
                        "<p style='color:#ff0066;'>This address exists but is not a parsed SPL token mint.</p>";
                    return;
                }

                const mintAccount = mintResult.value;
                const mintParsed = mintAccount.data && mintAccount.data.parsed ? mintAccount.data.parsed : null;
                mintParsedType = mintParsed ? mintParsed.type : null;
                mintParsedInfo = mintParsed ? mintParsed.info || {} : {};
            }

            if (mintParsedType !== "mint") {
                resultDiv.innerHTML = `
                    <p style="color:#ffaa00;">Valid token account, but mint data isn‚Äôt in standard parsed format.</p>
                    <p>We can‚Äôt reliably read mint authority from this RPC.</p>
                `;
                return;
            }

            const mintAuthorityOption = mintParsedInfo.mintAuthorityOption;
            const mintAuthority = mintParsedInfo.mintAuthority || null;

            if (mintAuthorityOption === 0) {
                // No authority present
                resultDiv.innerHTML = `
                    <p style="color:#00ff88; font-size:32px;">üü¢ LOW RISK</p>
                    <p style="color:#00ff88; font-size:22px;">Mint authority RENOUNCED</p>
                    <p>Dev cannot mint more tokens from this mint account.</p>
                    <p style="font-size:14px; opacity:0.8;">Mint: <code>${mintAddress}</code></p>
                `;
            } else if (mintAuthorityOption === 1 && mintAuthority) {
                resultDiv.innerHTML = `
                    <p style="color:#ff0066; font-size:32px;">üî¥ HIGH RISK</p>
                    <p style="color:#ff0066; font-size:22px;">Mint authority ACTIVE</p>
                    <p>Dev (or another authority) can mint more tokens.</p>
                    <p style="font-size:14px; opacity:0.8;">
                        Mint: <code>${mintAddress}</code><br>
                        Authority: <code>${mintAuthority}</code>
                    </p>
                `;
            } else {
                // Parsed, but no clear mintAuthorityOption field
                resultDiv.innerHTML = `
                    <p style="color:#ffaa00; font-size:28px;">üü° RISK UNKNOWN</p>
                    <p>Mint exists, but RPC did not return standard mint authority fields.</p>
                    <p style="font-size:14px; opacity:0.8;">Mint: <code>${mintAddress}</code></p>
                `;
            }
        }
    </script>

</body>
</html>
