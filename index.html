<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glassbox â€“ Solana Rug Checker</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 40px;
            background: #000;
            color: #fff;
            margin: 0;
        }
        h1 { font-size: 3em; }
        input {
            width: 100%; max-width: 600px;
            padding: 14px;
            font-size: 16px;
            border-radius: 10px;
            border: 1px solid #444;
            background: #111;
            color: #fff;
            margin: 20px auto;
        }
        button {
            padding: 14px 30px;
            background:#00ff88;
            color:#000;
            border:none;
            border-radius:10px;
            font-size:18px;
            cursor:pointer;
        }
        #result {
            margin: 30px auto;
            padding: 25px;
            border: 1px solid #333;
            border-radius: 10px;
            background:#111;
            max-width: 600px;
            min-height: 120px;
            font-size: 18px;
        }
    </style>
</head>
<body>

<h1>Glassbox</h1>
<p>Paste any Solana token mint â†’ see if devs can rug you.</p>

<input id="tokenInput" placeholder="e.g. EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v">
<button onclick="checkToken()">Check Token Now</button>

<div id="result"></div>

<script>
    const RPC = "https://api.mainnet-beta.solana.com";

    async function rpc(method, params) {
        const res = await fetch(RPC, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ jsonrpc:"2.0", id:1, method, params })
        });
        const data = await res.json();
        return data.result;
    }

    // Decode SPL token mint from base64 â†’ extract mintAuthorityOption + mintAuthority pubkey
    function decodeMintAccount(base64Data) {
        const raw = Uint8Array.from(atob(base64Data), c => c.charCodeAt(0));

        // Mint layout offsets:
        // https://spl.solana.com/token#token-mint
        return {
            mintAuthorityOption: raw[0],
            mintAuthority: bs58Encode(raw.slice(4, 36)),
        };
    }

    function bs58Encode(bytes) {
        const alphabet = "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";
        let carry, digits = [0];
        for (let i = 0; i < bytes.length; i++) {
            carry = bytes[i];
            for (let j = 0; j < digits.length; j++) {
                carry += digits[j] * 256;
                digits[j] = carry % 58;
                carry = (carry / 58) | 0;
            }
            while (carry) {
                digits.push(carry % 58);
                carry = (carry / 58) | 0;
            }
        }
        return digits.reverse().map(d => alphabet[d]).join("");
    }

    async function checkToken() {
        const address = document.getElementById("tokenInput").value.trim();
        const result = document.getElementById("result");

        if (!address) {
            result.innerHTML = "<p style='color:#ff0066;'>Enter a token mint address.</p>";
            return;
        }

        result.innerHTML = "<p>Checking on-chain data...</p>";

        const info = await rpc("getAccountInfo", [address, { encoding: "base64" }]);

        if (!info || !info.value) {
            result.innerHTML = "<p style='color:#ff0066;'>Not a valid account on Solana.</p>";
            return;
        }

        const [dataBase64] = info.value.data;

        let mint;
        try {
            mint = decodeMintAccount(dataBase64);
        } catch (e) {
            result.innerHTML = `
                <p style="color:#ffaa00;">Token exists, but cannot decode mint layout.</p>
            `;
            return;
        }

        if (mint.mintAuthorityOption === 0) {
            result.innerHTML = `
                <p style="color:#00ff88; font-size:28px;">ðŸŸ¢ LOW RISK</p>
                <p>Mint authority renounced.</p>
                <p>Dev CANNOT mint more tokens â€” anti-rug protection.</p>
            `;
        } else {
            result.innerHTML = `
                <p style="color:#ff0066; font-size:28px;">ðŸ”´ HIGH RISK</p>
                <p>Mint authority ACTIVE.</p>
                <p>Dev CAN mint unlimited tokens â€” classic rug setup.</p>
                <p><small>Mint authority: ${mint.mintAuthority}</small></p>
            `;
        }
    }
</script>

</body>
</html>
