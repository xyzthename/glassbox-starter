<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlassBox ‚Äì Solana Token Risk Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #05060a;
      --card: #0b0f16;
      --accent: #16f29a;
      --accent-soft: rgba(22, 242, 154, 0.12);
      --border-subtle: rgba(255, 255, 255, 0.06);
      --text-main: #f7f9ff;
      --text-muted: #9ca3b5;
      --danger: #ff4b6b;
      --warn: #facc15;
      --good: #22c55e;
      --chip-bg: rgba(15, 23, 42, 0.95);
      --chip-border: rgba(148, 163, 184, 0.7);
      --toxic: #ef4444;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Inter", sans-serif;
      background: radial-gradient(circle at top, #061021 0%, #020308 55%, #000 100%);
      color: #f9fafb;
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 20px;
      position: relative;
    }

    .glass-cracks-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image: url("/glass-cracks.png");
      background-size: cover;
      background-position: center;
      opacity: 0.22;
      mix-blend-mode: screen;
      z-index: 0;
    }

    .app {
      width: 100%;
      max-width: 1200px;
      margin: auto;
      position: relative;
      z-index: 1;
    }

    .frame {
      border-radius: 24px;
      padding: 1px;
      background: linear-gradient(
        135deg,
        rgba(22, 242, 154, 0.35),
        rgba(59, 130, 246, 0.2)
      );
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
    }

    .inner {
      border-radius: 24px;
      background: radial-gradient(circle at top left, #020617 0, #020617 45%, #020617 100%);
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.4fr);
      gap: 20px;
      padding: 18px;
    }

    @media (max-width: 980px) {
      .inner {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .left-col {
      display: flex;
      flex-direction: column;
      gap: 12px;
      justify-content: space-between;
    }

    .right-col {
      display: flex;
      flex-direction: column;
    }

    .pill-bar {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 11px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(22, 242, 154, 0.8);
      font-size: 11px;
      color: var(--accent);
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #16f29a, #22c55e 60%, #052e16);
      box-shadow: 0 0 0 1px rgba(22, 242, 154, 0.7);
    }

    .hero-title {
      margin-top: 4px;
      font-size: 26px;
      font-weight: 800;
      line-height: 1.15;
    }

    .hero-title span.clean {
      color: var(--accent);
    }
    .hero-title span.toxic {
      color: var(--toxic);
    }

    .hero-sub {
      margin-top: 4px;
      font-size: 13px;
      color: var(--text-muted);
      max-width: 380px;
    }

    .hero-logo-wrapper {
      margin-top: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hero-logo {
      max-width: 160px;
      height: auto;
      opacity: 0.9;
      filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.3));
    }

    .mint-card {
      margin-top: 10px;
      border-radius: 18px;
      background: rgba(8, 12, 21, 0.96);
      border: 1px solid rgba(30, 64, 175, 0.7);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9);
      padding: 12px;
    }

    .mint-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .mint-label {
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 10px;
    }

    .mint-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .mint-input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(30, 64, 175, 0.85);
      background: #020617;
      color: var(--text-main);
      font-size: 13px;
      padding: 8px 12px;
      outline: none;
    }

    .mint-input::placeholder {
      color: rgba(148, 163, 184, 0.9);
    }

    .btn-scan {
      border-radius: 999px;
      border: none;
      padding: 8px 18px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: radial-gradient(circle at top, #16f29a, #16a34a 65%);
      color: #020617;
      box-shadow: 0 12px 28px rgba(22, 242, 154, 0.45);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-scan:disabled {
      opacity: 0.55;
      box-shadow: none;
      cursor: default;
    }

    .mint-hint {
      margin-top: 7px;
      display: flex;
      align-items: center;
      gap: 7px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .hint-icon {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }

    .recent-wrap {
      margin-top: 8px;
    }

    .recent-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    .risk-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
    }

    .risk-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.75);
      background: rgba(15, 23, 42, 0.95);
      font-size: 11px;
      white-space: nowrap;
      cursor: pointer;
    }

    .risk-pill.safe {
      border-color: rgba(22, 242, 154, 0.8);
      background: rgba(22, 163, 74, 0.2);
      color: #bbf7d0;
    }

    .risk-pill.watch {
      border-color: rgba(250, 204, 21, 0.9);
      background: rgba(161, 98, 7, 0.4);
      color: #fef3c7;
    }

    .risk-pill.risky {
      border-color: rgba(248, 113, 113, 0.9);
      background: rgba(127, 29, 29, 0.5);
      color: #fecaca;
    }

    .risk-pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(22, 242, 154, 0.9);
    }

    .risk-pill-dot.red {
      background: #ef4444;
    }

    .footer-note {
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .footer-note a {
      color: var(--accent);
      text-decoration: none;
    }

    .result-shell {
      border-radius: 18px;
      background: rgba(8, 12, 21, 0.98);
      border: 1px solid var(--border-subtle);
      padding: 12px 14px;
      min-height: 260px;
    }

    .result-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 8px;
    }

    .risk-banner {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.75);
      background: rgba(15, 23, 42, 0.95);
    }

    .risk-banner.low {
      border-color: rgba(22, 242, 154, 0.9);
      background: rgba(22, 163, 74, 0.18);
      color: var(--accent);
    }

    .risk-banner.medium {
      border-color: rgba(250, 204, 21, 0.9);
      background: rgba(202, 138, 4, 0.18);
      color: var(--warn);
    }

    .risk-banner.high {
      border-color: rgba(248, 113, 113, 0.95);
      background: rgba(127, 29, 29, 0.5);
      color: var(--danger);
    }

    .result-top-right {
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .live-dot {
      display: inline-block;
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--good);
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.4);
    }

    .live-dot.off {
      background: var(--danger);
      box-shadow: 0 0 0 2px rgba(248, 113, 113, 0.4);
    }

    .token-header-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .token-logo {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #1f2937, #020617);
      border: 1px solid rgba(148, 163, 184, 0.7);
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      flex-shrink: 0;
    }

    .token-name {
      font-size: 13px;
      font-weight: 600;
    }

    .token-symbol {
      font-size: 11px;
      color: var(--text-muted);
      margin-left: 4px;
    }

    .token-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }

    .metrics-row {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 6px;
      margin: 8px 0;
    }

    @media (max-width: 820px) {
      .metrics-row {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .metric {
      border-radius: 10px;
      background: #020617;
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 6px 8px;
      font-size: 11px;
    }

    .metric-label {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 10px;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .metric-value {
      font-size: 12px;
      font-weight: 500;
    }

    .metric-sub {
      font-size: 10px;
      color: var(--text-muted);
    }

    .section-heading {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-muted);
      margin-top: 4px;
      margin-bottom: 3px;
    }

    .two-col {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 8px;
    }

    @media (max-width: 820px) {
      .two-col {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .info-card {
      border-radius: 10px;
      background: #020617;
      border: 1px dashed rgba(31, 41, 55, 0.9);
      padding: 6px 8px;
      font-size: 11px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 3px;
    }

    .info-label {
      color: var(--text-muted);
    }

    .chip {
      border-radius: 999px;
      padding: 2px 8px;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      font-size: 10px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .chip.good {
      border-color: rgba(22, 242, 154, 0.85);
      background: rgba(22, 163, 74, 0.18);
      color: var(--accent);
    }

    .chip.bad {
      border-color: rgba(248, 113, 113, 0.9);
      background: rgba(127, 29, 29, 0.5);
      color: var(--danger);
    }

    .chip.warn {
      border-color: rgba(250, 204, 21, 0.9);
      background: rgba(161, 98, 7, 0.4);
      color: var(--warn);
    }

    .info-note {
      margin-top: 2px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .holders-box {
      margin-top: 6px;
      border-radius: 10px;
      background: #020617;
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 6px 8px;
      font-size: 11px;
    }

    .holder-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .holder-pill {
      border-radius: 999px;
      padding: 4px 8px;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      font-size: 11px;
      text-decoration: none;
      color: var(--text-main);
      white-space: nowrap;
    }

    .holder-pill.lp {
      border-color: rgba(56, 189, 248, 0.95);
    }

    .origin-box {
      margin-top: 6px;
      border-radius: 10px;
      background: #020617;
      border: 1px dashed rgba(31, 41, 55, 0.9);
      padding: 6px 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .origin-box b {
      color: var(--accent);
    }

    .tools-row {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
    }

    .tool-pill {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      color: var(--text-main);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .bottom-row {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
      flex-wrap: wrap;
      font-size: 11px;
      align-items: center;
    }

    .btn-ghost {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid var(--chip-border);
      background: transparent;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      font-size: 11px;
      text-decoration: none;
    }

    .jup-btn {
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid rgba(22, 242, 154, 0.9);
      background: rgba(22, 163, 74, 0.18);
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 7px;
      cursor: pointer;
      font-size: 11px;
    }

    .jup-icon {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #16f29a, #16a34a 60%, #020617);
      box-shadow: 0 0 0 1px rgba(22, 242, 154, 0.85);
      /* If you prefer an actual Jupiter logo image, swap with:
         background-image:url('/jupiter-logo.png'); background-size:cover; background-position:center;
      */
    }

    .error-box {
      margin-top: 6px;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid rgba(248, 113, 113, 0.95);
      background: rgba(127, 29, 29, 0.45);
      font-size: 12px;
      color: var(--danger);
      display: none;
    }
  </style>
</head>
<body>
  <div class="glass-cracks-overlay"></div>

  <div class="app">
    <div class="frame">
      <div class="inner">
        <!-- LEFT SIDE -->
        <div class="left-col">
          <div>
            <div class="pill-bar">
              <span class="pill-dot"></span>
              <span>GlassBox v0.1</span>
              <span>Mint ¬∑ Freeze ¬∑ Holders ¬∑ Origin</span>
            </div>
            <div class="hero-title">
              Paste a Solana token mint.<br />
              See if it‚Äôs <span class="clean">clean</span> or <span class="toxic">toxic</span> in seconds.
            </div>
            <div class="hero-sub">
              No wallet connect. No signup. Just an instant on-chain safety read on any SPL token mint.
            </div>

            <div class="mint-card">
              <div class="mint-head">
                <span class="mint-label">Token mint address</span>
                <span>Solana SPL or Token-2022 mint</span>
              </div>
              <div class="mint-row">
                <input
                  id="mintInput"
                  class="mint-input"
                  type="text"
                  placeholder="Ex: EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v (USDC)"
                />
                <button id="scanBtn" class="btn-scan">
                  <span id="scanBtnLabel">Scan</span>
                  <span id="scanBtnSpinner" style="display:none;">‚è≥</span>
                </button>
              </div>
              <div class="mint-hint">
                <div class="hint-icon">üîí</div>
                <div>We never see or store your wallet or keys. Only mint + public on-chain data.</div>
              </div>

              <!-- recent scans -->
              <div class="recent-wrap">
                <div class="recent-label">Recent scans</div>
                <div id="recentRow" class="risk-pills"></div>
              </div>
            </div>

            <div class="footer-note">
              Built for degen safety by
              <a href="https://x.com/Glassboxscans" target="_blank" rel="noopener noreferrer">@GlassBox</a>
            </div>
            <div class="hero-logo-wrapper">
              <img src="/glassbox-logo.png" alt="GlassBox logo" class="hero-logo" />
            </div>
          </div>
        </div>

        <!-- RIGHT SIDE -->
        <div class="right-col">
          <div class="result-shell">
            <div id="resultBox">
              <div style="font-size:12px;color:var(--text-muted);">
                Paste a Solana token mint on the left and hit <b>Scan</b> to see:
                <ul style="padding-left:18px;margin:4px 0;">
                  <li>Mint / freeze authority status</li>
                  <li>Holder concentration + insider clusters</li>
                  <li>Liquidity truth and lock % bands</li>
                  <li>Likely origin (Pump.fun, stables, etc.)</li>
                </ul>
                Then route to Jupiter, DexScreener, Axiom, Photon, BullX, Padre, Solpump, or Stalk.fun in one tap.
              </div>
            </div>
            <div id="errorBox" class="error-box"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ====== YOUR AFFILIATE / REF LINKS ====== */
    const JUP_REF     = "3Gkf49tYL3JNjawedx9HX94LbnSMQ6eTQLTR8i8rkxWG";
    const AXIOM_URL   = "https://axiom.trade/@dudexyz";
    const BULLX_URL   = "https://t.me/BullxBetaBot?start=access_N3OJF4TE16J";
    const PARDE_URL   = "https://trade.padre.gg/rk/dudexyz";
    const PHOTON_URL  = "https://photon-sol.tinyastro.io/@xyzthegod";
    const STALK_URL   = "https://stalk.fun/?r=ZATEZOJI";
    const SOLPUMP_URL = "https://solpump.io/a/DUDEXYZ";
    /* ========================================= */

    const API_BASE = "/api/check";

    const mintInput       = document.getElementById("mintInput");
    const scanBtn         = document.getElementById("scanBtn");
    const scanBtnLabel    = document.getElementById("scanBtnLabel");
    const scanBtnSpinner  = document.getElementById("scanBtnSpinner");
    const resultBox       = document.getElementById("resultBox");
    const errorBox        = document.getElementById("errorBox");
    const recentRow       = document.getElementById("recentRow");

    const RECENT_KEY = "glassbox_recent_mints";
    const MAX_RECENT = 5;

    function setLoading(on) {
      if (on) {
        scanBtn.disabled = true;
        scanBtnLabel.textContent = "Scanning‚Ä¶";
        scanBtnSpinner.style.display = "inline";
      } else {
        scanBtn.disabled = false;
        scanBtnLabel.textContent = "Scan";
        scanBtnSpinner.style.display = "none";
      }
    }

    function shortAddr(addr) {
      if (!addr || addr.length <= 8) return addr || "";
      return addr.slice(0, 4) + "‚Ä¶" + addr.slice(-4);
    }

    function formatNumber(n) {
      if (n == null || isNaN(n)) return "‚Äî";
      const x = Number(n);
      if (x < 1000) return x.toFixed(0);
      if (x < 1_000_000) return (x / 1_000).toFixed(1) + "K";
      if (x < 1_000_000_000) return (x / 1_000_000).toFixed(1) + "M";
      return (x / 1_000_000_000).toFixed(1) + "B";
    }

    function formatUsd(v) {
      if (v == null || isNaN(v)) return "‚Äî";
      const n = Number(v);
      if (n <= 0) return "$0";
      if (n < 0.0001) {
        const s = n.toFixed(12);
        const parts = s.split(".");
        const dec = (parts[1] || "").replace(/0+$/, "");
        if (!dec) return "$0";
        let zeros = 0;
        let digits = "";
        for (const c of dec) {
          if (c === "0" && !digits) zeros++;
          else digits += c;
        }
        const sub = "‚ÇÄ‚ÇÅ‚ÇÇ‚ÇÉ‚ÇÑ‚ÇÖ‚ÇÜ‚Çá‚Çà‚Çâ".split("");
        const toSub = (num) =>
          String(num)
            .split("")
            .map((d) => sub[Number(d)] ?? d)
            .join("");
        return "$0.0" + toSub(zeros) + digits;
      }
      if (n < 1) return "$" + n.toFixed(6).replace(/0+$/, "").replace(/\.$/, "");
      if (n < 1000) return "$" + n.toFixed(4).replace(/0+$/, "").replace(/\.$/, "");
      if (n < 1_000_000) return "$" + n.toFixed(0);
      if (n < 1_000_000_000)
        return "$" + (n / 1_000_000).toFixed(2).replace(/0+$/, "").replace(/\.$/, "") + "M";
      return "$" + (n / 1_000_000_000).toFixed(2).replace(/0+$/, "").replace(/\.$/, "") + "B";
    }

    function formatAge(tokenAge) {
      if (!tokenAge || tokenAge.days == null) return { main: "N/A", sub: "" };

      const days = tokenAge.days;
      const totalMinutes = days * 24 * 60;

      // < 1 hour ‚Üí minutes
      if (totalMinutes < 60) {
        const mins = Math.max(1, Math.floor(totalMinutes));
        return { main: `${mins}m`, sub: "" };
      }

      const totalHours = days * 24;

      // < 1 day ‚Üí hours
      if (totalHours < 24) {
        const hrs = Math.floor(totalHours);
        return { main: `${hrs}h`, sub: "" };
      }

      // < 2 weeks ‚Üí days
      if (days < 14) {
        const d = Math.floor(days);
        return { main: `${d}d`, sub: "" };
      }

      // < 1 year ‚Üí months + days
      if (days < 365) {
        const months = (days / 30).toFixed(1);
        return { main: `${months}m`, sub: `‚âà ${Math.floor(days)} days` };
      }

      // ‚â• 1 year ‚Üí years + days
      const years = (days / 365).toFixed(1);
      return { main: `${years}y`, sub: `‚âà ${Math.floor(days)} days` };
    }

    function renderError(msg) {
      errorBox.style.display = "block";
      errorBox.textContent = msg || "Something went wrong.";
      updateLiveDot(false);
    }

    function clearError() {
      errorBox.style.display = "none";
      errorBox.textContent = "";
    }

    function bannerClass(level) {
      if (level === "low") return "risk-banner low";
      if (level === "high") return "risk-banner high";
      if (level === "medium") return "risk-banner medium";
      return "risk-banner";
    }

    function chipClass(level) {
      if (level === "good") return "chip good";
      if (level === "bad") return "chip bad";
      if (level === "warn") return "chip warn";
      return "chip";
    }

    function updateLiveDot(ok) {
      const el = document.getElementById("liveDot");
      if (!el) return;
      if (ok) el.classList.remove("off");
      else el.classList.add("off");
    }

    // recent history
    function saveRecentMint(mint, symbol, riskLevel) {
      try {
        const labelSymbol = (symbol || "").toUpperCase();
        const raw = localStorage.getItem(RECENT_KEY);
        let arr = [];
        if (raw) {
          arr = JSON.parse(raw);
          if (!Array.isArray(arr)) arr = [];
        }
        arr = arr.filter((i) => i.mint !== mint);
        arr.unshift({
          mint,
          symbol: labelSymbol,
          risk: riskLevel || "unknown",
        });
        if (arr.length > MAX_RECENT) arr = arr.slice(0, MAX_RECENT);
        localStorage.setItem(RECENT_KEY, JSON.stringify(arr));
        renderRecentMints(arr);
      } catch (_) {}
    }

    function loadRecentMints() {
      try {
        const raw = localStorage.getItem(RECENT_KEY);
        if (!raw) {
          recentRow.innerHTML =
            '<span style="font-size:11px;color:var(--text-muted);">No scans yet.</span>';
          return;
        }
        const arr = JSON.parse(raw);
        if (!Array.isArray(arr) || !arr.length) {
          recentRow.innerHTML =
            '<span style="font-size:11px;color:var(--text-muted);">No scans yet.</span>';
          return;
        }
        renderRecentMints(arr);
      } catch (_) {
        recentRow.innerHTML =
          '<span style="font-size:11px;color:var(--text-muted);">No scans yet.</span>';
      }
    }

    function renderRecentMints(arr) {
      if (!recentRow) return;
      if (!arr || !arr.length) {
        recentRow.innerHTML =
          '<span style="font-size:11px;color:var(--text-muted);">No scans yet.</span>';
        return;
      }
      recentRow.innerHTML = arr
        .map((item, idx) => {
          let cls = "risk-pill";
          if (item.risk === "high") cls += " risky";
          else if (item.risk === "low") cls += " safe";
          else cls += " watch";

          let riskLabel =
            item.risk === "high"
              ? "Risky"
              : item.risk === "low"
              ? "Safe"
              : "Watch";

          const label = item.symbol || (idx + 1) + " ¬∑ " + riskLabel;

          return `<button type="button" class="${cls}" data-mint="${item.mint}">
                    <span class="risk-pill-dot ${item.risk === "high" ? "red" : ""}"></span>
                    <span>${label}</span>
                  </button>`;
        })
        .join("");
    }

    function render(data, mint) {
      const {
        tokenMeta,
        mintInfo,
        holderSummary,
        insiderSummary,
        originHint,
        riskSummary,
        tokenMetrics,
        tokenAge,
        liquidityTruth,
        socials,
        insiderClusters,
      } = data;

      const name = tokenMeta?.name || "Unknown Token";
      const symbol = tokenMeta?.symbol || "";
      const logo = tokenMeta?.logoURI || null;

      const ageFmt = formatAge(tokenAge);

      const rawSupply = mintInfo?.supply;
      const decimals = mintInfo?.decimals ?? 0;
      const supplyHuman =
        rawSupply != null ? Number(rawSupply) / Math.pow(10, decimals || 0) : null;

      const holdersCount = holderSummary?.holdersCount ?? null;
      const top10Pct =
        holderSummary?.top10PctExcludingLP ?? holderSummary?.top10Pct ?? null;
      const lpHolder = holderSummary?.lpHolder || null;
      const topHolders = holderSummary?.topHolders || [];

      const renouncedMint = !mintInfo?.mintAuthority;
      const canFreeze = !!mintInfo?.freezeAuthority;

      const liqTruthLevel = liquidityTruth?.level || "unknown";
      const liqTruthLabel = liquidityTruth?.label || "Unknown";
      const liqTruthNote =
        liquidityTruth?.note ||
        "Not enough DEX data to judge whether liquidity is real or spoofed.";

      const lockPercent = liquidityTruth?.lockPercent;
      let liqLockLabel = "Unknown";
      let liqLockChipClass = "chip warn";
      if (typeof lockPercent === "number" && !isNaN(lockPercent)) {
        const pct = Math.max(0, Math.min(100, lockPercent));
        liqLockLabel = pct.toFixed(0) + "% locked";
        if (pct >= 90) liqLockChipClass = "chip good";
        else if (pct >= 80) liqLockChipClass = "chip warn";
        else liqLockChipClass = "chip bad";
      }

      const riskLevel = riskSummary?.level || "unknown";
      let riskLabel = "Unknown risk";
      if (riskLevel === "low") riskLabel = "Low rug risk (mint side)";
      else if (riskLevel === "medium") riskLabel = "Medium risk";
      else if (riskLevel === "high") riskLabel = "High rug risk";

      const scoreRaw =
        typeof riskSummary?.score === "number" ? riskSummary.score : null;
      const score =
        scoreRaw != null ? Math.max(0, Math.min(100, scoreRaw)) : null;

      const ic = insiderClusters || {};
      const clusterRisk = ic.riskLevel || insiderSummary?.riskLevel || "low";
      const clusterNote =
        ic.note ||
        insiderSummary?.note ||
        "No strong funding-based insider clusters detected among sampled holders.";
      const largestCluster = ic.largestCluster || null;
      const insiderTotalPct = insiderSummary?.insidersTotalPct ?? null;

      let clusterChipClass = "chip";
      if (clusterRisk === "high") clusterChipClass = "chip bad";
      else if (clusterRisk === "medium") clusterChipClass = "chip warn";
      else if (clusterRisk === "low") clusterChipClass = "chip good";

      const clusterHeadline = largestCluster
        ? `${largestCluster.holderAddresses.length} wallets via ${shortAddr(
            largestCluster.funder
          )} ¬∑ ~${largestCluster.pctOfSupply.toFixed(1)}%`
        : insiderSummary?.largestInsider
        ? `Largest insider ${shortAddr(
            insiderSummary.largestInsider.address
          )} ¬∑ ~${insiderSummary.largestInsider.pct.toFixed(1)}%`
        : "No strong cluster among sampled holders.";

      const top10BarWidth =
        top10Pct != null && !isNaN(top10Pct)
          ? Math.max(0, Math.min(100, top10Pct))
          : null;

      const originLabel = originHint?.label || "Unknown protocol / origin";
      const originDetail =
        originHint?.detail ||
        "Origin could not be confidently determined from mint pattern.";

      // Social pill (from backend DexScreener info)
      let socialLabel = null;
      let socialUrl = null;
      if (socials) {
        if (socials.twitter) {
          socialLabel = "View tweet / X";
          socialUrl = socials.twitter;
        } else if (socials.website) {
          socialLabel = "Visit website";
          socialUrl = socials.website;
        } else if (socials.telegram) {
          socialLabel = "Open Telegram";
          socialUrl = socials.telegram;
        }
      }

      // Route URLs with Jupiter referral
      const jupUrl = `https://jup.ag/swap/SOL-${encodeURIComponent(
        mint
      )}?referrer=${encodeURIComponent(JUP_REF)}`;
      const dexsUrl   = `https://dexscreener.com/solana/${mint}`;
      const axiomUrl  = AXIOM_URL;
      const photonUrl = PHOTON_URL;
      const bullxUrl  = BULLX_URL;
      const pardeUrl  = PARDE_URL;
      const stalkUrl  = STALK_URL;
      const solpumpUrl = SOLPUMP_URL;

      resultBox.innerHTML = `
        <div class="result-top">
          <div class="${bannerClass(riskLevel)}">
            <span>GlassBox risk</span>
            <span>‚Ä¢</span>
            <span>${riskLabel}</span>
          </div>
          <div class="result-top-right">
            <span id="liveDot" class="live-dot"></span>
            <span>Live on-chain scan</span>
          </div>
        </div>

        <div class="token-header-row">
          <div class="token-logo" style="${
            logo ? `background-image:url('${logo.replace(/"/g, "")}');` : ""
          }"></div>
          <div>
            <div class="token-name">
              ${name}
              ${symbol ? `<span class="token-symbol">(${symbol})</span>` : ""}
            </div>
            <div class="token-subtitle">${shortAddr(mint)}</div>
          </div>
        </div>

        ${
          riskSummary?.blurb
            ? `<div class="token-subtitle" style="margin-top:2px;">${riskSummary.blurb}</div>`
            : ""
        }

        ${
          score !== null
            ? `
        <div style="margin:6px 0 4px 0;">
          <div style="display:flex;align-items:center;justify-content:space-between;font-size:11px;color:var(--text-muted);margin-bottom:2px;">
            <span>GlassBox scam score (0‚Äì100)</span>
            <span style="color:var(--accent);font-weight:600;">${score.toFixed(
              0
            )}/100</span>
          </div>
          <div style="height:6px;border-radius:999px;background:#020617;border:1px solid rgba(31,41,55,0.9);overflow:hidden;">
            <div style="height:100%;width:${score}%;background:linear-gradient(90deg,#22c55e,#eab308,#ef4444);"></div>
          </div>
        </div>
        `
            : ""
        }

        <div class="metrics-row">
          <div class="metric">
            <div class="metric-label">Price</div>
            <div class="metric-value">${formatUsd(tokenMetrics?.priceUsd)}</div>
          </div>
          <div class="metric">
            <div class="metric-label">Liquidity</div>
            <div class="metric-value">${formatUsd(
              tokenMetrics?.liquidityUsd
            )}</div>
          </div>
          <div class="metric">
            <div class="metric-label">Supply</div>
            <div class="metric-value">${
              supplyHuman != null ? formatNumber(supplyHuman) : "‚Äî"
            }</div>
          </div>
          <div class="metric">
            <div class="metric-label">Holders</div>
            <div class="metric-value">${
              holdersCount != null ? formatNumber(holdersCount) : "N/A"
            }</div>
            ${
              holdersCount == null
                ? `<div class="metric-sub">RPC limit / index missing</div>`
                : ""
            }
          </div>
          <div class="metric">
            <div class="metric-label">Token age</div>
            <div class="metric-value">${ageFmt.main}</div>
            ${ageFmt.sub ? `<div class="metric-sub">${ageFmt.sub}</div>` : ""}
          </div>
        </div>

        <div class="two-col">
          <div class="info-card">
            <div class="section-heading">Token info</div>
            <div class="info-row">
              <span class="info-label">Mint authority</span>
              <span class="${chipClass(renouncedMint ? "good" : "bad")}">
                ${renouncedMint ? "Renounced / disabled" : "Can still mint"}
              </span>
            </div>
            <div class="info-row">
              <span class="info-label">Freeze authority</span>
              <span class="${chipClass(canFreeze ? "bad" : "good")}">
                ${canFreeze ? "Can freeze tokens" : "None"}
              </span>
            </div>
            <div class="info-row">
              <span class="info-label">Liquidity lock %</span>
              <span class="${liqLockChipClass}">${liqLockLabel}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Liquidity truth</span>
              <span class="${chipClass(
                liqTruthLevel === "low"
                  ? "good"
                  : liqTruthLevel === "high"
                  ? "bad"
                  : "warn"
              )}" title="${liqTruthNote.replace(/"/g, "&quot;")}">
                ${liqTruthLabel}
              </span>
            </div>
            <div class="info-note">
              ${
                renouncedMint
                  ? "No more supply can be minted from this authority."
                  : "Mint authority still active ‚Äì dev can mint more supply."
              }
            </div>
          </div>

          <div class="info-card">
            <div class="section-heading">Holder risk</div>
            <div class="info-row">
              <span class="info-label">Top 10 (excl. LP)</span>
              <span class="${chipClass(
                top10Pct != null && top10Pct <= 25
                  ? "good"
                  : top10Pct != null && top10Pct <= 50
                  ? "warn"
                  : "bad"
              )}">
                ${
                  top10Pct != null
                    ? top10Pct.toFixed(1) + "% of supply"
                    : "N/A"
                }
              </span>
            </div>
            <div class="info-row">
              <span class="info-label">Insider wallets ‚â•1%</span>
              <span class="${chipClass(
                insiderTotalPct != null && insiderTotalPct <= 20
                  ? "good"
                  : insiderTotalPct != null && insiderTotalPct <= 40
                  ? "warn"
                  : "bad"
              )}">
                ${
                  insiderSummary?.insiderWalletCount ??
                  insiderSummary?.insidersAll?.length ??
                  0
                } wallets ¬∑ ${
        insiderTotalPct != null
          ? insiderTotalPct.toFixed(1) + "%"
          : "N/A"
      }
              </span>
            </div>
            <div class="info-row">
              <span class="info-label">Funding clusters</span>
              <span class="${clusterChipClass}">${clusterHeadline}</span>
            </div>
            ${
              top10BarWidth !== null
                ? `
            <div style="margin-top:4px;font-size:10px;color:var(--text-muted);">
              ${top10Pct.toFixed(1)}% held by top 10 wallets (excl. LP)
            </div>
            <div style="margin-top:2px;height:4px;border-radius:999px;background:#020617;border:1px solid rgba(31,41,55,0.9);overflow:hidden;">
              <div style="height:100%;width:${top10BarWidth}%;background:linear-gradient(90deg,#22c55e,#eab308,#ef4444);"></div>
            </div>`
                : ""
            }
            <div class="info-note">${clusterNote}</div>
          </div>
        </div>

        <div class="holders-box">
          <div class="section-heading">Top holders (LP + whales)</div>
          ${
            topHolders && topHolders.length
              ? `<div class="holder-list">
                  ${topHolders
                    .map((h, idx) => {
                      const isLp =
                        lpHolder && lpHolder.address === h.address;
                      return `<a href="https://solscan.io/account/${h.address}"
                                target="_blank"
                                rel="noopener noreferrer"
                                class="holder-pill ${isLp ? "lp" : ""}">
                                ${String(idx + 1).padStart(
                                  2,
                                  "0"
                                )}. ${shortAddr(h.address)} ¬∑ ${h.pct.toFixed(
                        2
                      )}%${isLp ? " ¬∑ LP" : ""}
                              </a>`;
                    })
                    .join("")}
                </div>`
              : `<div class="info-note">Holder data not available for this mint.</div>`
          }
        </div>

        <div class="origin-box">
          <b>${originLabel}</b>
          ${originDetail ? " ‚Äì " + originDetail : ""}
        </div>

        <div class="tools-row">
          <a class="tool-pill" href="${dexsUrl}" target="_blank" rel="noopener noreferrer">üìä DexScreener</a>
          <a class="tool-pill" href="${axiomUrl}" target="_blank" rel="noopener noreferrer">üß† Axiom</a>
          <a class="tool-pill" href="${photonUrl}" target="_blank" rel="noopener noreferrer">‚ö° Photon</a>
          <a class="tool-pill" href="${bullxUrl}" target="_blank" rel="noopener noreferrer">üêÇ BullX</a>
          <a class="tool-pill" href="${pardeUrl}" target="_blank" rel="noopener noreferrer">‚öôÔ∏è Padre</a>
          <a class="tool-pill" href="${solpumpUrl}" target="_blank" rel="noopener noreferrer">üíß Solpump</a>
          <a class="tool-pill" href="${stalkUrl}" target="_blank" rel="noopener noreferrer">üïµÔ∏è Stalk.fun</a>
        </div>

        <div class="bottom-row">
          <div style="display:flex;gap:6px;flex-wrap:wrap;align-items:center;">
            <button id="copyMintBtn" class="btn-ghost">üìã Copy mint</button>
            <button id="copySummaryBtn" class="btn-ghost">üßæ Copy summary</button>
            ${
              socialLabel && socialUrl
                ? `<a href="${socialUrl}" target="_blank" rel="noopener noreferrer" class="btn-ghost">üì£ ${socialLabel}</a>`
                : ""
            }
          </div>
          <button id="jupBtn" class="jup-btn">
            <span class="jup-icon"></span>
            <span>Swap on Jupiter</span>
          </button>
        </div>
      `;

      updateLiveDot(true); // successful scan

      const jupBtn = document.getElementById("jupBtn");
      if (jupBtn) {
        jupBtn.onclick = () =>
          window.open(jupUrl, "_blank", "noopener,noreferrer");
      }

      const copyMintBtn = document.getElementById("copyMintBtn");
      if (copyMintBtn) {
        copyMintBtn.onclick = async () => {
          try {
            await navigator.clipboard.writeText(mint);
          } catch (_) {}
        };
      }

      const copySummaryBtn = document.getElementById("copySummaryBtn");
      if (copySummaryBtn) {
        copySummaryBtn.onclick = async () => {
          const summary = `${name} (${symbol || "no symbol"})\nMint: ${mint}\nRisk: ${
            riskLabel
          }\nInsiders: ${
            insiderTotalPct != null
              ? insiderTotalPct.toFixed(1) + "%"
              : "N/A"
          }`;
          try {
            await navigator.clipboard.writeText(summary);
          } catch (_) {}
        };
      }
    }

    async function doScan(mintRaw) {
      const mint = (mintRaw || "").trim();
      if (!mint) {
        renderError("Please paste a valid Solana mint address.");
        return;
      }
      clearError();
      setLoading(true);
      try {
        const res = await fetch(`${API_BASE}?mint=${encodeURIComponent(mint)}`);
        if (!res.ok) {
          const txt = await res.text();
          let msg = "Scan failed.";
          try {
            const j = JSON.parse(txt);
            if (j.error) msg = j.error;
          } catch (_) {}
          renderError(msg);
        } else {
          const data = await res.json();
          render(data, mint);
          const symbol = data?.tokenMeta?.symbol || "";
          const risk = data?.riskSummary?.level || "unknown";
          saveRecentMint(mint, symbol, risk);
        }
      } catch (e) {
        renderError("Network error while scanning mint.");
      } finally {
        setLoading(false);
      }
    }

    // Event wiring
    scanBtn.addEventListener("click", () => {
      doScan(mintInput.value);
    });

    mintInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        doScan(mintInput.value);
      }
    });

    if (recentRow) {
      recentRow.addEventListener("click", (e) => {
        const btn = e.target.closest("button[data-mint]");
        if (!btn) return;
        const mint = btn.getAttribute("data-mint");
        if (mint) {
          mintInput.value = mint;
          doScan(mint);
        }
      });
    }

    // On load
    loadRecentMints();
  </script>
</body>
</html>
